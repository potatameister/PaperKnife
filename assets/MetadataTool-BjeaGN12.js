import{u as U,j as e,a as A}from"./index-BCQnIPlM.js";import{r as l,af as C,l as E,I as K,X as T,G as S,a0 as z,ag as R}from"./vendor-ui-BjyPzBhQ.js";import{P as f}from"./pdf-lib-core-DPOFIJtO.js";import{g as $,P as O,u as G}from"./PrivacyBadge-BOpIVqZb.js";import{S as X}from"./SuccessState-BMiBheeQ.js";import{N as q}from"./NativeToolLayout-0pTs-BQS.js";import"./pdfjs-viewer-BENO9Ct1.js";function _(){const h=l.useRef(null),{consumePipelineFile:D}=U(),[s,u]=l.useState(null),[p,d]=l.useState(!1),[x,m]=l.useState(null),[w,L]=l.useState("paperknife-metadata"),[n,B]=l.useState(""),[g,y]=l.useState(!1),[c,b]=l.useState({title:"",author:localStorage.getItem("defaultAuthor")||"",subject:"",keywords:"",creator:localStorage.getItem("defaultAuthor")||"PaperKnife",producer:localStorage.getItem("defaultAuthor")||"PaperKnife"});l.useEffect(()=>{const t=D();if(t){const a=new File([t.buffer],t.name,{type:"application/pdf"});k(a)}},[]);const M=async()=>{if(!s||!n)return;d(!0);const t=await G(s.file,n);if(t.success){const a=await s.file.arrayBuffer(),o=await f.load(a,{password:n}),r={title:o.getTitle()||"",author:o.getAuthor()||"",subject:o.getSubject()||"",keywords:o.getKeywords()||"",creator:o.getCreator()||"",producer:o.getProducer()||""};u({...s,isLocked:!1,pageCount:t.pageCount,password:n,currentMeta:r}),b(r)}else S.error("Incorrect password");d(!1)},k=async t=>{if(t.type==="application/pdf"){d(!0);try{const a=await $(t);let o={title:"",author:"",subject:"",keywords:"",creator:"",producer:""};if(!a.isLocked){const r=await t.arrayBuffer(),i=await f.load(r);o={title:i.getTitle()||"",author:i.getAuthor()||"",subject:i.getSubject()||"",keywords:i.getKeywords()||"",creator:i.getCreator()||"",producer:i.getProducer()||""}}u({file:t,pageCount:a.pageCount,isLocked:a.isLocked,currentMeta:o}),b(o),L(`${t.name.replace(".pdf","")}-metadata`)}catch(a){console.error(a)}finally{d(!1),m(null)}}},j=async(t=!1)=>{if(s){d(!0),t&&y(!0),await new Promise(a=>setTimeout(a,300));try{const a=await s.file.arrayBuffer(),o=await f.load(a,{password:s.password||void 0,ignoreEncryption:!0});let r;t?(r=await f.create(),(await r.copyPages(o,o.getPageIndices())).forEach(I=>r.addPage(I))):r=o,r.setTitle(c.title),r.setAuthor(c.author),r.setSubject(c.subject),r.setKeywords(c.keywords.split(",").map(N=>N.trim())),r.setCreator(c.creator||"PaperKnife"),r.setProducer(c.producer||"PaperKnife");const i=await r.save(),v=new Blob([i],{type:"application/pdf"}),P=URL.createObjectURL(v);m(P),A({name:`${w}.pdf`,tool:"Metadata",size:v.size,resultUrl:P})}catch(a){S.error(`Error: ${a.message}`)}finally{d(!1),y(!1)}}},F=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:()=>j(!1),disabled:p,className:"w-full bg-rose-500 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20",children:[p&&!g?e.jsx(z,{className:"animate-spin"}):e.jsx(C,{size:18})," Update Metadata"]}),e.jsxs("button",{onClick:()=>j(!0),disabled:p,className:"w-full bg-emerald-500 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-emerald-500/20",children:[g?e.jsx(z,{className:"animate-spin"}):e.jsx(R,{size:18})," Privacy Deep Clean"]})]});return e.jsxs(q,{title:"Metadata Editor",description:"Edit or wipe document properties for better privacy.",actions:s&&!s.isLocked&&!x&&e.jsx(F,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:h,onChange:t=>t.target.files?.[0]&&k(t.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto relative z-[100]",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center shadow-2xl",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(E,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"File Protected"}),e.jsx("input",{type:"password",value:n,onChange:t=>B(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4 dark:text-white"}),e.jsx("button",{onClick:M,disabled:!n||p,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-2xl flex items-center justify-center shrink-0",children:e.jsx(K,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:s.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[s.pageCount," Pages â€¢ ",(s.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>u(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(T,{size:20})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-6 shadow-sm",children:[x?e.jsx(X,{message:g?"Deep Clean Successful!":"Metadata Updated!",downloadUrl:x,fileName:`${w}.pdf`,onStartOver:()=>{m(null),u(null)}}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["title","author","subject","keywords","creator","producer"].map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest px-1",children:t}),e.jsx("input",{type:"text",value:c[t],onChange:a=>b({...c,[t]:a.target.value}),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]},t))}),e.jsx("button",{onClick:()=>u(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})]}):e.jsxs("div",{onClick:()=>!p&&h.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(C,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start editing metadata"})]}),e.jsx(O,{})]})}export{_ as default};

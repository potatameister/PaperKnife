import{u as _,j as e,a as L}from"./index-DVQ_-K-e.js";import{r as o,a2 as E,w as R,p as J,X as Z,a5 as G,P as H,t as S,a3 as K}from"./vendor-ui-DVJtqS_b.js";import{J as X}from"./vendor-utils-BuRRKp-C.js";import{g as q,l as Q,P as V,u as Y,r as ee}from"./PrivacyBadge-BptljzUF.js";import{u as te}from"./useObjectURL-BPDTmczq.js";import{S as se}from"./SuccessState-R0HWCMze.js";import{N as ae}from"./NativeToolLayout-Bywg2nrF.js";import"./tesseract-core-8J3qwSEB.js";import"./pdfjs-viewer-BENO9Ct1.js";const re=({pdfDoc:m,pageNum:b})=>{const[c,w]=o.useState(null),i=o.useRef(null);return o.useEffect(()=>{if(!m||c)return;const a=new IntersectionObserver(x=>{x[0].isIntersecting&&(ee(m,b,1).then(w),a.disconnect())},{rootMargin:"200px"});return i.current&&a.observe(i.current),()=>a.disconnect()},[m,b,c]),c?e.jsx("img",{src:c,className:"w-full h-full object-cover animate-in fade-in duration-300",alt:`Page ${b}`}):e.jsx("div",{ref:i,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center text-xs font-bold text-gray-400",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function me(){const m=o.useRef(null),{consumePipelineFile:b}=_(),{objectUrl:c,createUrl:w,clearUrls:i}=te(),[a,x]=o.useState(null),[C,f]=o.useState(!1),[j,v]=o.useState(!1),[u,g]=o.useState(new Set),[h,U]=o.useState("paperknife-split"),[P,N]=o.useState(""),[k,z]=o.useState("single"),[y,$]=o.useState("");o.useEffect(()=>{const t=b();if(t){const s=new File([t.buffer],t.name,{type:"application/pdf"});F(s)}},[]);const A=async()=>{if(!a||!y)return;v(!0);const t=await Y(a.file,y);if(t.success){x({...a,isLocked:!1,pageCount:t.pageCount,pdfDoc:t.pdfDoc,password:y,thumbnail:t.thumbnail});const s=new Set;for(let n=1;n<=t.pageCount;n++)s.add(n);g(s),N(`1-${t.pageCount}`)}else S.error("Incorrect password");v(!1)},F=async t=>{if(t.type==="application/pdf"){v(!0);try{const s=await q(t);if(s.isLocked)x({file:t,pageCount:0,isLocked:!0});else{const n=await Q(t);x({file:t,pageCount:s.pageCount,isLocked:!1,pdfDoc:n,thumbnail:s.thumbnail});const r=new Set;for(let l=1;l<=s.pageCount;l++)r.add(l);g(r),N(`1-${s.pageCount}`)}}catch(s){console.error(s)}finally{v(!1),i()}}},M=t=>{t.target.files?.[0]&&F(t.target.files[0])},I=t=>{const s=new Set(u);s.has(t)?s.delete(t):s.add(t),g(s),i()},T=t=>{if(!a)return;const s=new Set;t.split(",").map(r=>r.trim()).forEach(r=>{if(r.includes("-")){const[l,d]=r.split("-").map(Number);if(!isNaN(l)&&!isNaN(d))for(let p=Math.max(1,l);p<=Math.min(d,a.pageCount);p++)s.add(p)}else{const l=Number(r);!isNaN(l)&&l>=1&&l<=a.pageCount&&s.add(l)}}),g(s),i()},B=async()=>{if(!(!a||u.size===0)){f(!0);try{const t=await a.file.arrayBuffer(),s=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"});s.postMessage({type:"SPLIT_PDF",payload:{buffer:t,password:a.password,selectedPages:Array.from(u),mode:k,customFileName:h}}),s.onmessage=async n=>{const{type:r,payload:l}=n.data;if(r==="SUCCESS"){const d=new Blob([l],{type:"application/pdf"}),p=w(d);L({name:`${h||"split"}.pdf`,tool:"Split",size:d.size,resultUrl:p}),f(!1),s.terminate()}else if(r==="SUCCESS_BATCH"){const d=new X;l.forEach(D=>{d.file(D.name,D.buffer)});const p=await d.generateAsync({type:"blob"}),W=w(p);L({name:`${h||"split"}.zip`,tool:"Split",size:p.size,resultUrl:W}),f(!1),s.terminate()}else r==="ERROR"&&(S.error(l),f(!1),s.terminate())}}catch(t){S.error(t.message||"Error splitting PDF."),f(!1)}}},O=()=>e.jsx("button",{onClick:B,disabled:C||u.size===0,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20",children:C?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"animate-spin"})," Working..."]}):e.jsxs(e.Fragment,{children:["Extract ",u.size," Pages ",e.jsx(K,{size:18})]})});return e.jsxs(ae,{title:"Split PDF",description:"Select pages visually or by range to extract them. Everything stays on your device.",actions:a&&!a.isLocked&&!c&&e.jsx(O,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:m,onChange:M}),a?a.isLocked?e.jsx("div",{className:"max-w-md mx-auto relative z-[100]",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 shadow-2xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(J,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:y,onChange:t=>$(t.target.value),placeholder:"Enter Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4 dark:text-white",autoFocus:!0}),e.jsx("button",{onClick:A,disabled:!y||j,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all active:scale-95 disabled:opacity-50",children:"Unlock PDF"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500 shadow-inner",children:a.thumbnail?e.jsx("img",{src:a.thumbnail,className:"w-full h-full object-cover"}):e.jsx(R,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:a.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:[a.pageCount," Pages â€¢ ",(a.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>x(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(Z,{size:20})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-[10px] text-gray-400 px-2",children:"Page Selection"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const t=new Set;for(let s=1;s<=a.pageCount;s++)t.add(s);g(t)},className:"text-[10px] font-black uppercase text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 px-2 py-1 rounded-lg transition-colors",children:"Select All"}),e.jsx("button",{onClick:()=>g(new Set),className:"text-[10px] font-black uppercase text-gray-400 px-2 py-1 hover:bg-gray-50 dark:hover:bg-white/5 rounded-lg transition-colors",children:"Clear"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-1 scrollbar-hide",children:Array.from({length:a.pageCount}).map((t,s)=>{const n=s+1,r=u.has(n);return e.jsxs("div",{onClick:()=>I(n),className:`relative group cursor-pointer aspect-[3/4] rounded-xl overflow-hidden border-2 transition-all ${r?"border-rose-500 shadow-md scale-[1.02]":"border-transparent hover:border-gray-200 dark:hover:border-zinc-800"}`,children:[e.jsx(re,{pdfDoc:a.pdfDoc,pageNum:n}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center transition-opacity ${r?"bg-rose-500/10 opacity-100":"bg-black/20 opacity-0 group-hover:opacity-100"}`,children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shadow-lg transition-transform ${r?"bg-rose-500 text-white scale-100":"bg-white text-gray-400 scale-75"}`,children:r?e.jsx(G,{size:20,strokeWidth:3}):e.jsx(H,{size:20})})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[9px] font-black text-white",children:["PAGE ",n]})]},n)})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm sticky top-24",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3",children:"Split Mode"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 bg-gray-50 dark:bg-black p-1 rounded-2xl",children:[e.jsx("button",{onClick:()=>{z("single"),i()},className:`py-2 px-3 rounded-xl text-[10px] font-black uppercase transition-all ${k==="single"?"bg-white dark:bg-zinc-800 text-rose-500 shadow-sm":"text-gray-400"}`,children:"Single"}),e.jsx("button",{onClick:()=>{z("individual"),i()},className:`py-2 px-3 rounded-xl text-[10px] font-black uppercase transition-all ${k==="individual"?"bg-white dark:bg-zinc-800 text-rose-500 shadow-sm":"text-gray-400"}`,children:"ZIP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:h,onChange:t=>U(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3",children:"Range Selection"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:P,onChange:t=>N(t.target.value),placeholder:"e.g. 1, 3-5",className:"flex-1 bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"}),e.jsx("button",{onClick:()=>T(P),className:"px-4 bg-rose-500 text-white rounded-xl font-black text-[10px] uppercase active:scale-95 transition-transform",children:"Apply"})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4 px-1",children:[e.jsx("span",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"Selected"}),e.jsxs("span",{className:"text-xl font-black text-rose-500",children:[u.size," ",e.jsx("span",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-widest",children:"Pages"})]})]}),c&&e.jsx(se,{message:"Split Successful!",downloadUrl:c,fileName:`${h||"split"}.${k==="single"?"pdf":"zip"}`,onStartOver:()=>i(),showPreview:k==="single"})]}),e.jsx("button",{onClick:()=>{x(null),i()},className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})})})]})]}):e.jsx("div",{onClick:()=>!j&&m.current?.click(),className:`border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group ${j?"opacity-50 cursor-wait":""}`,children:j?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(E,{size:48,className:"text-rose-500 animate-spin mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Analyzing PDF..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(R,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF File"}),e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Tap to start splitting"})]})}),e.jsx(V,{})]})}export{me as default};

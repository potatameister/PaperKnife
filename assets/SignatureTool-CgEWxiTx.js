import{u as V,C as W,j as t,a as Z}from"./index-CrqUSg-E.js";import{r as a,aa as F,p as _,a2 as I,t as ee,a3 as te}from"./vendor-ui-D7-yJfeG.js";import{P as se}from"./pdf-lib-core-D4Eo6sTa.js";import{g as ae,l as ne,r as B,P as oe,u as ie}from"./PrivacyBadge-BHcAHnXd.js";import{S as re}from"./SuccessState-xd4KAoMP.js";import{N as le}from"./NativeToolLayout-BiYB0yh8.js";import"./pdfjs-viewer-BENO9Ct1.js";function he(){const y=a.useRef(null),j=a.useRef(null),h=a.useRef(null),{consumePipelineFile:T}=V(),[n,l]=a.useState(null),[d,x]=a.useState(null),[w,X]=a.useState(null),[S,r]=a.useState(!1),[b,v]=a.useState(null),[g,$]=a.useState(""),[E]=a.useState(1),[c,k]=a.useState({x:50,y:50}),[u,Y]=a.useState(150),[N,P]=a.useState(null),[C,f]=a.useState(!1),[D,p]=a.useState(!1),A=W.isNativePlatform();a.useEffect(()=>{const e=T();if(e){const s=new File([e.buffer],e.name,{type:"application/pdf"});z(s)}},[]);const O=async()=>{if(!(!n||!g)){r(!0);try{const e=await ie(n.file,g);if(e.success){l({...n,isLocked:!1,pageCount:e.pageCount,pdfDoc:e.pdfDoc,password:g});const s=await B(e.pdfDoc,1,2);P(s)}else ee.error("Incorrect password")}finally{r(!1)}}},z=async e=>{if(e.type==="application/pdf"){r(!0);try{const s=await ae(e);if(s.isLocked)l({file:e,pageCount:0,isLocked:!0});else{const i=await ne(e);l({file:e,pageCount:s.pageCount,isLocked:!1,pdfDoc:i});const o=await B(i,1,2);P(o)}}finally{r(!1)}}},R=e=>{if(!h.current)return;const s=h.current.getBoundingClientRect(),i="touches"in e?e.touches[0].clientX:e.clientX,o="touches"in e?e.touches[0].clientY:e.clientY;if(C)k({x:Math.max(0,Math.min(100,(i-s.left)/s.width*100)),y:Math.max(0,Math.min(100,(o-s.top)/s.height*100))});else if(D){const m=c.x/100*s.width+s.left;Y(Math.max(50,Math.min(s.width,i-(m-u/2))))}},J=async()=>{if(!(!n||!w)){r(!0);try{const e=await n.file.arrayBuffer(),s=await se.load(e,{password:n.password,ignoreEncryption:!0}),i=await w.arrayBuffer();let o=w.type==="image/png"?await s.embedPng(i):await s.embedJpg(i);const m=s.getPages()[E-1],{width:G,height:M}=m.getSize(),H=c.x/100*G,K=M-c.y/100*M-u*(o.height/o.width);m.drawImage(o,{x:H,y:K,width:u,height:u*(o.height/o.width)});const Q=await s.save(),L=new Blob([Q],{type:"application/pdf"}),U=URL.createObjectURL(L);v(U),Z({name:`signed-${n.file.name}`,tool:"Signature",size:L.size,resultUrl:U})}finally{r(!1)}}},q=()=>t.jsx("button",{onClick:J,disabled:S||!d,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${A?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:S?t.jsx(I,{className:"animate-spin"}):t.jsxs(t.Fragment,{children:["Sign & Save ",t.jsx(te,{size:18})]})});return t.jsxs(le,{title:"Signature",description:"Sign any PDF by dragging your signature image.",actions:n&&!n.isLocked&&!b&&t.jsx(q,{}),children:[t.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:y,onChange:e=>e.target.files?.[0]&&z(e.target.files[0])}),t.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:j,onChange:e=>{const s=e.target.files?.[0];s&&(X(s),x(URL.createObjectURL(s)))}}),n?n.isLocked?t.jsxs("div",{className:"max-w-md mx-auto p-8 bg-white dark:bg-zinc-900 rounded-3xl text-center",children:[t.jsx(_,{size:32,className:"mx-auto mb-4 text-rose-500"}),t.jsx("input",{type:"password",value:g,onChange:e=>$(e.target.value),className:"w-full p-4 mb-4 border rounded-xl"}),t.jsx("button",{onClick:O,className:"w-full p-4 bg-rose-500 text-white rounded-xl",children:"Unlock"})]}):t.jsxs("div",{className:"space-y-6",onMouseMove:R,onTouchMove:R,onMouseUp:()=>{f(!1),p(!1)},onTouchEnd:()=>{f(!1),p(!1)},children:[b?t.jsx(re,{message:"Signed Successfully!",downloadUrl:b,fileName:`signed-${n.file.name}`,onStartOver:()=>{v(null),l(null),x(null)}}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-3xl border border-gray-100 dark:border-white/5 relative aspect-[1/1.4] overflow-hidden touch-none",ref:h,onClick:e=>{if(!d||C||D)return;const s=e.currentTarget.getBoundingClientRect();k({x:(e.clientX-s.left)/s.width*100,y:(e.clientY-s.top)/s.height*100})},children:[N?t.jsx("img",{src:N,className:"w-full h-full object-contain"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(I,{className:"animate-spin text-rose-500"})}),d&&t.jsxs("div",{onMouseDown:e=>{e.stopPropagation(),f(!0)},onTouchStart:e=>{e.stopPropagation(),f(!0)},style:{left:`${c.x}%`,top:`${c.y}%`,width:`${u}px`,transform:"translate(-50%, -50%)"},className:"absolute cursor-move ring-2 ring-rose-500 rounded-sm",children:[t.jsx("img",{src:d,className:"w-full pointer-events-none"}),t.jsx("div",{onMouseDown:e=>{e.stopPropagation(),p(!0)},onTouchStart:e=>{e.stopPropagation(),p(!0)},className:"absolute -bottom-2 -right-2 w-6 h-6 bg-rose-500 rounded-full border-2 border-white cursor-nwse-resize"})]})]}),t.jsx("div",{className:"flex gap-4",children:t.jsx("button",{onClick:()=>j.current?.click(),className:"flex-1 p-4 bg-gray-50 dark:bg-zinc-800 text-gray-900 dark:text-white border border-gray-100 dark:border-white/5 rounded-2xl font-black uppercase text-xs hover:border-rose-500 transition-all",children:t.jsxs("span",{className:"flex items-center justify-center gap-2",children:[t.jsx(F,{size:16})," Upload Signature"]})})})]}),t.jsx("button",{onClick:()=>{l(null),x(null)},className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]}):t.jsxs("div",{onClick:()=>y.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 transition-all cursor-pointer group",children:[t.jsx(F,{size:32,className:"mx-auto mb-4 text-rose-500"}),t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Select PDF"})]}),t.jsx(oe,{})]})}export{he as default};

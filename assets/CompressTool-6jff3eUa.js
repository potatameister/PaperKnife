import{u as J,j as e,a as W}from"./index-B6cJ0uzj.js";import{r as c,E as U,Z as T,K as q,a0 as G,P as H,_ as V,D as Y,a4 as ee,a5 as se,h as te}from"./vendor-ui-D1EBEKOk.js";import{J as re}from"./vendor-utils-CnmmTxJY.js";import{g as ae,u as ie,l as A,r as $}from"./pdfHelpers-DLNmFKBe.js";import{u as oe}from"./useObjectURL-CZGgftbZ.js";import{T as ne,P as le}from"./PrivacyBadge-Wo8Xzpg5.js";import{S as ce}from"./SuccessState--U3S_iRb.js";import"./tesseract-core-CetndT4m.js";import"./pdfjs-viewer-BENO9Ct1.js";const de=({originalBuffer:y,compressedBuffer:P})=>{const[D,j]=c.useState(""),[h,F]=c.useState(""),[f,o]=c.useState(50),l=c.useRef(null);c.useEffect(()=>{(async()=>{try{const p=await A(new File([y],"orig.pdf",{type:"application/pdf"})),z=await A(new File([P],"comp.pdf",{type:"application/pdf"})),b=await $(p,1,2),E=await $(z,1,2);j(b),F(E)}catch(p){console.error("Comparison thumb load failed",p)}})()},[y,P]);const k=g=>{if(!l.current)return;const p=l.current.getBoundingClientRect(),b=(("touches"in g?g.touches[0].clientX:g.clientX)-p.left)/p.width*100;o(Math.max(0,Math.min(100,b)))};return!D||!h?e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center bg-gray-50 dark:bg-zinc-900 rounded-3xl border border-gray-100 dark:border-zinc-800 animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-rose-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:"Rendering Comparison..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-2",children:[e.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400 flex items-center gap-2",children:[e.jsx(ee,{size:12})," Quality Inspection"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-gray-400",children:"Original"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter text-rose-500",children:"Compressed"})]})]}),e.jsxs("div",{ref:l,className:"relative h-80 md:h-[400px] rounded-[2rem] overflow-hidden cursor-ew-resize select-none border border-gray-100 dark:border-zinc-800 shadow-inner group",onMouseMove:k,onTouchMove:k,children:[e.jsx("img",{src:h,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Compressed"}),e.jsx("div",{className:"absolute inset-0 w-full h-full overflow-hidden",style:{clipPath:`inset(0 ${100-f}% 0 0)`},children:e.jsx("img",{src:D,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Original"})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-xl z-10 flex items-center justify-center",style:{left:`${f}%`},children:e.jsxs("div",{className:"w-8 h-8 bg-white dark:bg-zinc-900 rounded-full shadow-2xl border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:[e.jsx(se,{size:14,className:"-mr-0.5"}),e.jsx(te,{size:14,className:"-ml-0.5"})]})}),e.jsx("div",{className:"absolute bottom-4 left-4 bg-black/50 backdrop-blur-md px-3 py-1.5 rounded-xl text-[10px] font-black text-white uppercase tracking-widest pointer-events-none",children:"Original"}),e.jsx("div",{className:"absolute bottom-4 right-4 bg-rose-500/80 backdrop-blur-md px-3 py-1.5 rounded-xl text-[10px] font-black text-white uppercase tracking-widest pointer-events-none",children:"Compressed"})]}),e.jsx("p",{className:"text-[9px] text-center text-gray-400 font-bold uppercase tracking-wider",children:"Drag the slider to compare pixels (First page shown)"})]})};function ye(){const y=c.useRef(null),{consumePipelineFile:P,setPipelineFile:D,lastPipelinedFile:j}=J(),{objectUrl:h,createUrl:F,clearUrls:f}=oe(),[o,l]=c.useState([]),[k,g]=c.useState(!1),[p,z]=c.useState(0),[b,E]=c.useState("medium"),[I,C]=c.useState(!1);c.useEffect(()=>{const s=P();if(s)try{const a=new File([s.buffer],s.name,{type:"application/pdf"});O([a]),U.info(`Received ${a.name} from pipeline`)}catch(a){console.error("Pipeline file conversion failed",a)}},[]);const O=async s=>{const a=Array.from(s).filter(t=>t.type==="application/pdf").map(t=>({id:Math.random().toString(36).substr(2,9),file:t,pageCount:0,isLocked:!1,status:"pending"}));l(t=>[...t,...a]),C(!1),f();for(const t of a)try{const r=await ae(t.file);l(n=>n.map(i=>i.id===t.id?{...i,pageCount:r.pageCount,isLocked:r.isLocked,thumbnail:r.thumbnail,pdfDoc:r.isLocked?void 0:null}:i))}catch(r){console.error(r)}},Q=async(s,a)=>{const t=o.find(n=>n.id===s);if(!t)return;const r=await ie(t.file,a);r.success?l(n=>n.map(i=>i.id===s?{...i,isLocked:!1,pageCount:r.pageCount,pdfDoc:r.pdfDoc,thumbnail:r.thumbnail,password:a}:i)):U.error(`Incorrect password for ${t.file.name}`)},Z=s=>{s.target.files&&O(s.target.files)},K=async(s,a)=>{let t=s.pdfDoc;t||(t=await A(s.file));const r={high:1,medium:1.5,low:2},n={high:.3,medium:.5,low:.7},i=r[a],u=n[a],w=[];for(let m=1;m<=s.pageCount;m++){const B=await t.getPage(m),d=B.getViewport({scale:i}),x=document.createElement("canvas"),v=x.getContext("2d");if(!v)continue;x.height=d.height,x.width=d.width,await B.render({canvasContext:v,viewport:d}).promise;const S=x.toDataURL("image/jpeg",u).split(",")[1],N=window.atob(S),M=new Uint8Array(N.length);for(let R=0;R<N.length;R++)M[R]=N.charCodeAt(R);w.push({imageBytes:M,width:d.width,height:d.height}),x.width=0,x.height=0}return new Promise((m,B)=>{const d=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"}),x=w.map(v=>v.imageBytes.buffer);d.postMessage({type:"COMPRESS_PDF_ASSEMBLY",payload:{pages:w,quality:a}},x),d.onmessage=v=>{const{type:L,payload:S}=v.data;if(L==="SUCCESS"){const N=new Blob([S],{type:"application/pdf"}),M=F(N);m({url:M,size:N.size,buffer:S}),d.terminate()}else L==="ERROR"&&(B(new Error(S)),d.terminate())}})},X=async()=>{const s=o.filter(t=>!t.isLocked&&t.status==="pending");if(s.length===0)return;g(!0),z(0);const a=[];for(let t=0;t<s.length;t++){const r=s[t];l(n=>n.map(i=>i.id===r.id?{...i,status:"processing"}:i));try{const{url:n,size:i,buffer:u}=await K(r,b);if(a.push({name:r.file.name.replace(".pdf","-compressed.pdf"),buffer:u}),l(w=>w.map(m=>m.id===r.id?{...m,status:"completed",resultUrl:n,resultSize:i}:m)),W({name:r.file.name.replace(".pdf","-compressed.pdf"),tool:"Compress",size:i,resultUrl:n}),s.length===1){const w=await s[0].file.arrayBuffer();D({buffer:u,name:r.file.name.replace(".pdf","-compressed.pdf"),originalBuffer:new Uint8Array(w)})}}catch{l(i=>i.map(u=>u.id===r.id?{...u,status:"error"}:u)),U.error(`Failed to compress ${r.file.name}`)}z(Math.round((t+1)/s.length*100))}if(a.length>1){const t=new re;a.forEach(n=>t.file(n.name,n.buffer));const r=await t.generateAsync({type:"blob"});F(r)}g(!1),C(!0)},_=s=>{l(a=>a.filter(t=>t.id!==s)),o.length<=1&&C(!1),f()};return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-4xl mx-auto px-6 py-6 md:py-10",children:[e.jsx(ne,{title:"Batch",highlight:"Shrinker",description:"Optimize multiple PDFs at once. Everything stays on your device."}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",ref:y,onChange:Z}),o.length===0?e.jsxs("div",{onClick:()=>y.current?.click(),className:"border-4 border-dashed border-gray-200 dark:border-zinc-800 rounded-[2rem] md:rounded-[2.5rem] bg-white/50 dark:bg-zinc-900/50 p-10 md:p-20 text-center hover:border-rose-300 dark:hover:border-rose-900 hover:bg-rose-50/50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6 group-hover:scale-110 transition-transform",children:e.jsx(T,{size:32})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-1 md:mb-2 group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors",children:"Select PDFs"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-400 dark:text-zinc-500",children:"Drop files or tap to start batch compression"})]}):I?e.jsxs("div",{className:"space-y-6",children:[h&&o.length>1&&e.jsxs("a",{href:h,download:"paperknife-compressed-batch.zip",className:"block w-full bg-zinc-900 dark:bg-white text-white dark:text-black p-8 rounded-[2.5rem] text-center shadow-2xl transition-all hover:scale-[1.01] active:scale-95 group",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform",children:e.jsx(Y,{className:"text-white",size:32})}),e.jsx("h3",{className:"text-2xl font-black tracking-tight mb-1",children:"Download All (ZIP)"}),e.jsxs("p",{className:"text-xs font-bold opacity-60 uppercase tracking-widest",children:[o.length," Optimized Documents"]})]}),h&&o.length===1&&e.jsxs("div",{className:"space-y-8",children:[j?.originalBuffer&&j?.buffer&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border border-gray-100 dark:border-zinc-800 shadow-sm",children:e.jsx(de,{originalBuffer:j.originalBuffer,compressedBuffer:j.buffer})}),e.jsx(ce,{message:`Compressed successfully! Reduced by ${((1-(o[0].resultSize||0)/o[0].file.size)*100).toFixed(0)}%`,downloadUrl:h,fileName:o[0].file.name.replace(".pdf","-compressed.pdf"),onStartOver:()=>{l([]),C(!1),f()}})]}),h&&o.length>1&&e.jsx("button",{onClick:()=>{l([]),C(!1),f()},className:"w-full py-4 text-gray-400 hover:text-rose-500 font-black uppercase tracking-[0.2em] text-xs transition-colors",children:"Start New Batch"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.map(s=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-gray-100 dark:border-zinc-800 flex items-center gap-4 relative group",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-zinc-800 rounded-lg overflow-hidden shrink-0",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(q,{className:"text-gray-300",size:16})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold truncate dark:text-white",children:s.file.name}),s.isLocked?e.jsx("div",{className:"flex gap-1 mt-1",children:e.jsx("input",{type:"password",placeholder:"Unlock...",className:"bg-gray-50 dark:bg-black text-[8px] p-1 rounded border border-gray-100 dark:border-zinc-800 outline-none w-20",onKeyDown:a=>{a.key==="Enter"&&Q(s.id,a.currentTarget.value)}})}):e.jsxs("p",{className:"text-[10px] text-gray-400 font-bold",children:[(s.file.size/(1024*1024)).toFixed(2)," MB â€¢ ",s.pageCount," p"]})]}),e.jsx("button",{onClick:()=>_(s.id),className:"p-1 text-gray-300 hover:text-rose-500",children:e.jsx(G,{size:14})})]},s.id)),e.jsxs("button",{onClick:()=>y.current?.click(),className:"border-2 border-dashed border-gray-100 dark:border-zinc-800 rounded-2xl p-4 text-gray-400 flex flex-col items-center justify-center gap-1 hover:border-rose-300 transition-all",children:[e.jsx(H,{size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter",children:"Add More"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-zinc-800 shadow-sm space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-4 flex items-center gap-2",children:[e.jsx(T,{size:12})," Compression Quality"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["high","medium","low"].map(s=>e.jsxs("button",{onClick:()=>E(s),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-1 ${b===s?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-zinc-800 hover:border-rose-200 dark:hover:border-rose-800"}`,children:[e.jsx("span",{className:`font-black uppercase text-[10px] ${b===s?"text-rose-500":"text-gray-400"}`,children:s}),e.jsx("span",{className:"text-[8px] text-gray-400 font-bold",children:s==="high"?"Max":s==="medium"?"Balanced":"Best"})]},s))})]}),k&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all duration-300",style:{width:`${p}%`}})}),e.jsxs("p",{className:"text-[10px] text-center font-black uppercase text-gray-400 tracking-widest animate-pulse",children:["Batch Progress: ",p,"%"]})]}),e.jsxs("button",{onClick:X,disabled:k||o.filter(s=>!s.isLocked).length===0,className:"w-full bg-rose-500 hover:bg-rose-600 text-white p-6 rounded-3xl shadow-xl shadow-rose-200 dark:shadow-none font-black text-xl tracking-tight transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3",children:[k?e.jsx(V,{className:"animate-spin"}):e.jsx(T,{}),"Compress ",o.length," Files"]})]})]}),e.jsx(le,{})]})})}export{ye as default};

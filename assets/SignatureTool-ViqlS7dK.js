import{C as H,j as t,a as K}from"./index-DobvBlpI.js";import{r as a,a4 as Q,l as W,V as I,z as Z,X as _}from"./vendor-ui-D2qmvH7L.js";import{P as ee}from"./pdf-lib-core-DzxZkFUh.js";import{N as te,P as se,u as ae,r as B,g as ne,l as oe}from"./NativeToolLayout-jdULbXfN.js";import{S as ie}from"./SuccessState-BHamHYGy.js";import"./pdfjs-viewer-BENO9Ct1.js";function fe(){const b=a.useRef(null),y=a.useRef(null),m=a.useRef(null),[n,h]=a.useState(null),[u,T]=a.useState(null),[x,F]=a.useState(null),[j,r]=a.useState(!1),[w,S]=a.useState(null),[d,X]=a.useState(""),[$]=a.useState(1),[l,v]=a.useState({x:50,y:50}),[c,Y]=a.useState(150),[k,N]=a.useState(null),[P,g]=a.useState(!1),[C,f]=a.useState(!1),D=H.isNativePlatform(),E=async()=>{if(!(!n||!d)){r(!0);try{const e=await ae(n.file,d);if(e.success){h({...n,isLocked:!1,pageCount:e.pageCount,pdfDoc:e.pdfDoc,password:d});const s=await B(e.pdfDoc,1,2);N(s)}else Z.error("Incorrect password")}finally{r(!1)}}},A=async e=>{if(e.type==="application/pdf"){r(!0);try{const s=await ne(e);if(s.isLocked)h({file:e,pageCount:0,isLocked:!0});else{const i=await oe(e);h({file:e,pageCount:s.pageCount,isLocked:!1,pdfDoc:i});const o=await B(i,1,2);N(o)}}finally{r(!1)}}},z=e=>{if(!m.current)return;const s=m.current.getBoundingClientRect(),i="touches"in e?e.touches[0].clientX:e.clientX,o="touches"in e?e.touches[0].clientY:e.clientY;if(P)v({x:Math.max(0,Math.min(100,(i-s.left)/s.width*100)),y:Math.max(0,Math.min(100,(o-s.top)/s.height*100))});else if(C){const p=l.x/100*s.width+s.left;Y(Math.max(50,Math.min(s.width,i-(p-c/2))))}},O=async()=>{if(!(!n||!x)){r(!0);try{const e=await n.file.arrayBuffer(),s=await ee.load(e,{password:n.password,ignoreEncryption:!0}),i=await x.arrayBuffer();let o=x.type==="image/png"?await s.embedPng(i):await s.embedJpg(i);const p=s.getPages()[$-1],{width:J,height:M}=p.getSize(),V=l.x/100*J,q=M-l.y/100*M-c*(o.height/o.width);p.drawImage(o,{x:V,y:q,width:c,height:c*(o.height/o.width)});const G=await s.save(),L=new Blob([G],{type:"application/pdf"}),U=URL.createObjectURL(L);S(U),K({name:`signed-${n.file.name}`,tool:"Signature",size:L.size,resultUrl:U})}finally{r(!1)}}},R=()=>t.jsx("button",{onClick:O,disabled:j||!u,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${D?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:j?t.jsx(I,{className:"animate-spin"}):t.jsxs(t.Fragment,{children:["Sign & Save ",t.jsx(_,{size:18})]})});return t.jsxs(te,{title:"Signature",description:"Sign any PDF by dragging your signature image.",actions:n&&!n.isLocked&&!w&&t.jsx(R,{}),children:[t.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:b,onChange:e=>e.target.files?.[0]&&A(e.target.files[0])}),t.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:y,onChange:e=>{const s=e.target.files?.[0];s&&(F(s),T(URL.createObjectURL(s)))}}),n?n.isLocked?t.jsxs("div",{className:"max-w-md mx-auto p-8 bg-white dark:bg-zinc-900 rounded-3xl text-center",children:[t.jsx(W,{size:32,className:"mx-auto mb-4 text-rose-500"}),t.jsx("input",{type:"password",value:d,onChange:e=>X(e.target.value),className:"w-full p-4 mb-4 border rounded-xl"}),t.jsx("button",{onClick:E,className:"w-full p-4 bg-rose-500 text-white rounded-xl",children:"Unlock"})]}):t.jsx("div",{className:"space-y-6",onMouseMove:z,onTouchMove:z,onMouseUp:()=>{g(!1),f(!1)},onTouchEnd:()=>{g(!1),f(!1)},children:w?t.jsx(ie,{message:"Signed Successfully!",downloadUrl:w,fileName:`signed-${n.file.name}`,onStartOver:()=>S(null)}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-3xl border border-gray-100 dark:border-white/5 relative aspect-[1/1.4] overflow-hidden touch-none",ref:m,onClick:e=>{if(!u||P||C)return;const s=e.currentTarget.getBoundingClientRect();v({x:(e.clientX-s.left)/s.width*100,y:(e.clientY-s.top)/s.height*100})},children:[k?t.jsx("img",{src:k,className:"w-full h-full object-contain"}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx(I,{className:"animate-spin text-rose-500"})}),u&&t.jsxs("div",{onMouseDown:e=>{e.stopPropagation(),g(!0)},onTouchStart:e=>{e.stopPropagation(),g(!0)},style:{left:`${l.x}%`,top:`${l.y}%`,width:`${c}px`,transform:"translate(-50%, -50%)"},className:"absolute cursor-move ring-2 ring-rose-500 rounded-sm",children:[t.jsx("img",{src:u,className:"w-full pointer-events-none"}),t.jsx("div",{onMouseDown:e=>{e.stopPropagation(),f(!0)},onTouchStart:e=>{e.stopPropagation(),f(!0)},className:"absolute -bottom-2 -right-2 w-6 h-6 bg-rose-500 rounded-full border-2 border-white cursor-nwse-resize"})]})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{onClick:()=>y.current?.click(),className:"flex-1 p-4 bg-gray-100 dark:bg-zinc-800 rounded-2xl font-black uppercase text-xs",children:"Upload Signature"}),!D&&t.jsx(R,{})]})]})}):t.jsxs("div",{onClick:()=>b.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 transition-all cursor-pointer group",children:[t.jsx(Q,{size:32,className:"mx-auto mb-4 text-rose-500"}),t.jsx("h3",{className:"text-xl font-bold dark:text-white",children:"Select PDF"})]}),t.jsx(se,{})]})}export{fe as default};

import{u as T,j as e,a as U}from"./index-CrqUSg-E.js";import{r as a,ad as P,p as B,X as M,a7 as C,t as D,a2 as $,ae as A}from"./vendor-ui-D7-yJfeG.js";import{P as z}from"./pdf-lib-core-D4Eo6sTa.js";import{u as G,a as k,D as K,c as _,S as H,r as X,s as q,K as J,T as Q,M as V,b as W,d as Y,C as Z}from"./vendor-utils-BJNTWQ9F.js";import{g as ee,l as re,P as te,u as se,r as ae}from"./PrivacyBadge-BHcAHnXd.js";import{S as oe}from"./SuccessState-xd4KAoMP.js";import{N as ne}from"./NativeToolLayout-BiYB0yh8.js";import"./tesseract-core-DDDi0QTq.js";import"./pdfjs-viewer-BENO9Ct1.js";const ie=({pdfDoc:c,pageNum:d})=>{const[t,o]=a.useState(null),l=a.useRef(null);return a.useEffect(()=>{if(!c||t)return;const n=new IntersectionObserver(u=>{u[0].isIntersecting&&(ae(c,d,1).then(o),n.disconnect())},{rootMargin:"200px"});return l.current&&n.observe(l.current),()=>n.disconnect()},[c,d,t]),t?e.jsx("img",{src:t,className:"w-full h-full object-contain bg-white pointer-events-none",alt:`P${d}`}):e.jsx("div",{ref:l,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function le({id:c,pageNum:d,pdfDoc:t}){const{attributes:o,listeners:l,setNodeRef:n,transform:u,transition:p,isDragging:x}=Y({id:c}),f={transform:Z.Transform.toString(u),transition:p,zIndex:x?100:0,position:"relative"};return e.jsxs("div",{ref:n,style:f,...o,...l,className:`relative group cursor-grab active:cursor-grabbing aspect-[3/4] rounded-xl overflow-hidden border-2 transition-all bg-gray-50 dark:bg-black touch-none ${x?"border-rose-500 shadow-2xl scale-105 opacity-90":"border-transparent hover:border-rose-500 shadow-sm"}`,children:[e.jsx("div",{className:"w-full h-full p-2",children:e.jsx(ie,{pdfDoc:t,pageNum:d})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 backdrop-blur-md rounded-lg p-1.5 text-white opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(A,{size:14})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[9px] font-black text-white",children:["PAGE ",d]})]})}function he(){const c=a.useRef(null),{consumePipelineFile:d}=T(),[t,o]=a.useState(null),[l,n]=a.useState([]),[u,p]=a.useState(!1),[x,f]=a.useState(null),[h,w]=a.useState("paperknife-rearranged"),[m,R]=a.useState(""),F=G(k(V,{activationConstraint:{distance:8}}),k(Q,{activationConstraint:{delay:200,tolerance:5}}),k(J,{coordinateGetter:q}));a.useEffect(()=>{const r=d();if(r){const s=new File([r.buffer],r.name,{type:"application/pdf"});v(s)}},[]);const L=async()=>{if(!t||!m)return;p(!0);const r=await se(t.file,m);r.success?(o({...t,isLocked:!1,pageCount:r.pageCount,pdfDoc:r.pdfDoc,password:m,thumbnail:r.thumbnail}),n(Array.from({length:r.pageCount},(s,i)=>(i+1).toString())),w(`${t.file.name.replace(".pdf","")}-rearranged`)):D.error("Incorrect password"),p(!1)},v=async r=>{if(r.type==="application/pdf"){p(!0);try{const s=await ee(r);if(s.isLocked)o({file:r,pageCount:0,isLocked:!0});else{const i=await re(r);o({file:r,pageCount:s.pageCount,isLocked:!1,pdfDoc:i,thumbnail:s.thumbnail}),n(Array.from({length:s.pageCount},(b,g)=>(g+1).toString())),w(`${r.name.replace(".pdf","")}-rearranged`)}}catch(s){console.error(s)}finally{p(!1),f(null)}}},E=r=>{const{active:s,over:i}=r;s.id!==i?.id&&(n(b=>{const g=b.indexOf(s.id),y=b.indexOf(i?.id);return W(b,g,y)}),f(null))},I=async()=>{if(t){p(!0),await new Promise(r=>setTimeout(r,100));try{const r=await t.file.arrayBuffer(),s=await z.load(r,{password:t.password||void 0,ignoreEncryption:!0}),i=await z.create(),b=l.map(j=>parseInt(j)-1);(await i.copyPages(s,b)).forEach(j=>i.addPage(j));const y=await i.save(),N=new Blob([y],{type:"application/pdf"}),S=URL.createObjectURL(N);f(S),U({name:`${h}.pdf`,tool:"Rearrange",size:N.size,resultUrl:S})}catch(r){D.error(`Error: ${r.message}`)}finally{p(!1)}}},O=()=>e.jsxs("button",{onClick:I,disabled:u,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20",children:[u?e.jsx($,{className:"animate-spin"}):e.jsx(C,{size:20})," Save New Order"]});return e.jsxs(ne,{title:"Rearrange PDF",description:"Drag and drop to reorder pages visually.",actions:t&&!t.isLocked&&!x&&e.jsx(O,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:c,onChange:r=>r.target.files?.[0]&&v(r.target.files[0])}),t?t.isLocked?e.jsx("div",{className:"max-w-md mx-auto relative z-[100]",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center shadow-2xl",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:m,onChange:r=>R(r.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4 dark:text-white"}),e.jsx("button",{onClick:L,disabled:!m||u,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500 shadow-inner",children:t.thumbnail?e.jsx("img",{src:t.thumbnail,className:"w-full h-full object-cover"}):e.jsx(P,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:t.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[t.pageCount," Pages â€¢ ",(t.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>o(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(M,{size:20})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 px-2",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-[10px] text-gray-400",children:"Hold & drag pages"}),e.jsxs("button",{onClick:()=>n(Array.from({length:t.pageCount},(r,s)=>(s+1).toString())),className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-1 hover:text-rose-500 transition-colors font-bold",children:[e.jsx(C,{size:12})," Reset"]})]}),e.jsx(K,{sensors:F,collisionDetection:_,onDragEnd:E,children:e.jsx(H,{items:l,strategy:X,children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 p-1",children:l.map(r=>e.jsx(le,{id:r,pageNum:parseInt(r),pdfDoc:t.pdfDoc},r))})})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm space-y-6",children:[x?e.jsx(oe,{message:"Rearranged Successfully!",downloadUrl:x,fileName:`${h}.pdf`,onStartOver:()=>{f(null),o(null)}}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:h,onChange:r=>w(r.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]})}),e.jsx("button",{onClick:()=>o(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})]}):e.jsxs("div",{onClick:()=>!u&&c.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(P,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Tap to start reordering"})]}),e.jsx(te,{})]})}export{he as default};

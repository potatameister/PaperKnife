import{u as k,j as e,a as N}from"./index-CqnREVVI.js";import{r as s,U as v,ai as b,X as F,a2 as P,aj as R,G as h}from"./vendor-ui-C2hlGh6M.js";import{P as z}from"./pdf-lib-core-C1d7PD49.js";import{S as C}from"./SuccessState-1lSBI22J.js";import{P as S}from"./PrivacyBadge-HaX4DNlE.js";import{N as D}from"./NativeToolLayout-CC2e3_8u.js";import"./pdfjs-viewer-BENO9Ct1.js";function $(){const c=s.useRef(null),{consumePipelineFile:g}=k(),[a,d]=s.useState(!1),[i,l]=s.useState(null),[r,o]=s.useState(null),[n,p]=s.useState("");s.useEffect(()=>{const t=g();if(t){const x=new File([t.buffer],t.name,{type:"application/pdf"});u(x)}},[]);const u=async t=>{t.type==="application/pdf"&&(o(t),p(`repaired-${t.name.replace(".pdf","")}`),l(null))},j=async()=>{if(r){d(!0);try{const t=await r.arrayBuffer(),w=await(await z.load(t,{ignoreEncryption:!0,throwOnInvalidObject:!1})).save(),m=new Blob([w],{type:"application/pdf"}),f=URL.createObjectURL(m);l(f),N({name:`${n}.pdf`,tool:"Repair",size:m.size,resultUrl:f}),h.success("PDF rebuilt successfully!")}catch(t){h.error(`Repair failed: ${t.message}`)}finally{d(!1)}}},y=()=>e.jsxs("button",{onClick:j,disabled:a,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20",children:[a?e.jsx(P,{className:"animate-spin"}):e.jsx(R,{size:20})," Attempt Repair"]});return e.jsxs(D,{title:"Repair PDF",description:"Fix corrupted or unreadable PDF files by rebuilding structure.",actions:r&&!i&&e.jsx(y,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:c,onChange:t=>t.target.files?.[0]&&u(t.target.files[0])}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-2xl flex items-center justify-center shrink-0",children:e.jsx(b,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:r.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:[(r.size/(1024*1024)).toFixed(2)," MB"]})]}),e.jsx("button",{onClick:()=>o(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(F,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-8 shadow-sm",children:i?e.jsx(C,{message:"Reconstruction Complete!",downloadUrl:i,fileName:`${n}.pdf`,onStartOver:()=>{l(null),o(null)},showPreview:!0}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:n,onChange:t=>p(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]})})})]}):e.jsxs("div",{onClick:()=>!a&&c.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(v,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select Corrupted PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse local files"})]}),e.jsxs("div",{className:"mt-8 p-6 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-white/5 flex items-start gap-4",children:[e.jsx(b,{className:"text-amber-500 shrink-0",size:20}),e.jsxs("div",{className:"text-xs text-amber-700 dark:text-amber-400 leading-relaxed text-left",children:[e.jsx("p",{className:"font-black mb-1 uppercase tracking-widest text-[10px]",children:"Technical Protocol:"}),'PaperKnife rebuilds the internal cross-reference table and regenerates the file structure from scratch. This can restore access to many files that "cannot be opened."']})]}),e.jsx(S,{})]})}export{$ as default};

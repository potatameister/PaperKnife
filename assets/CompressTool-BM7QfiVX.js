import{u as q,j as e,a as G}from"./index-D4tOBaEd.js";import{r as p,z,Z as P,J as H,Y as K,P as X,V as Y,D as W}from"./vendor-ui-hg1L1vqF.js";import{P as _}from"./pdf-lib-core-aMDJQxOy.js";import{J as ee}from"./vendor-utils-D07SJPAh.js";import{g as se,u as te,l as ae}from"./pdfHelpers-DLNmFKBe.js";import{u as re}from"./useObjectURL-D4VdEO11.js";import{T as oe,P as ie}from"./PrivacyBadge-CvFrspeL.js";import{S as ne}from"./SuccessState-DBSf3Gm4.js";import"./pdfjs-viewer-BENO9Ct1.js";function ye(){const b=p.useRef(null),{consumePipelineFile:A,setPipelineFile:E}=q(),{objectUrl:h,createUrl:C,clearUrls:u}=re(),[n,l]=p.useState([]),[w,S]=p.useState(!1),[D,F]=p.useState(0),[y,$]=p.useState("medium"),[I,g]=p.useState(!1);p.useEffect(()=>{const s=A();if(s)try{const r=new Blob([s.buffer],{type:"application/pdf"}),t=new File([r],s.name,{type:"application/pdf"});k([t]),z.info(`Received ${t.name} from pipeline`)}catch(r){console.error("Pipeline file conversion failed",r);const t=new Blob([s.buffer],{type:"application/pdf"}),a=new File([t],s.name,{type:"application/pdf"});k([a])}},[]);const k=async s=>{const r=Array.from(s).filter(t=>t.type==="application/pdf").map(t=>({id:Math.random().toString(36).substr(2,9),file:t,pageCount:0,isLocked:!1,status:"pending"}));l(t=>[...t,...r]),g(!1),u();for(const t of r)try{const a=await se(t.file);l(i=>i.map(o=>o.id===t.id?{...o,pageCount:a.pageCount,isLocked:a.isLocked,thumbnail:a.thumbnail,pdfDoc:a.isLocked?void 0:null}:o))}catch(a){console.error(a)}},R=async(s,r)=>{const t=n.find(i=>i.id===s);if(!t)return;const a=await te(t.file,r);a.success?l(i=>i.map(o=>o.id===s?{...o,isLocked:!1,pageCount:a.pageCount,pdfDoc:a.pdfDoc,thumbnail:a.thumbnail,password:r}:o)):z.error(`Incorrect password for ${t.file.name}`)},J=s=>{s.target.files&&k(s.target.files)},O=async(s,r)=>{let t=s.pdfDoc;t||(t=await ae(s.file));const a=await _.create(),i={high:1,medium:1.5,low:2},o={high:.3,medium:.5,low:.7},c=i[r],j=o[r];for(let v=1;v<=s.pageCount;v++){const L=await t.getPage(v),d=L.getViewport({scale:c}),f=document.createElement("canvas"),U=f.getContext("2d");if(!U)continue;f.height=d.height,f.width=d.width,await L.render({canvasContext:U,viewport:d}).promise;const Q=f.toDataURL("image/jpeg",j).split(",")[1],N=window.atob(Q),M=new Uint8Array(N.length);for(let x=0;x<N.length;x++)M[x]=N.charCodeAt(x);const V=await a.embedJpg(M);a.addPage([d.width,d.height]).drawImage(V,{x:0,y:0,width:d.width,height:d.height})}const m=await a.save(),B=new Blob([m],{type:"application/pdf"});return{url:C(B),size:B.size,buffer:m}},T=async()=>{const s=n.filter(t=>!t.isLocked&&t.status==="pending");if(s.length===0)return;S(!0),F(0);const r=[];for(let t=0;t<s.length;t++){const a=s[t];l(i=>i.map(o=>o.id===a.id?{...o,status:"processing"}:o));try{const{url:i,size:o,buffer:c}=await O(a,y);r.push({name:a.file.name.replace(".pdf","-compressed.pdf"),buffer:c}),l(j=>j.map(m=>m.id===a.id?{...m,status:"completed",resultUrl:i,resultSize:o}:m)),G({name:a.file.name.replace(".pdf","-compressed.pdf"),tool:"Compress",size:o,resultUrl:i}),s.length===1&&E({buffer:c,name:a.file.name.replace(".pdf","-compressed.pdf")})}catch{l(o=>o.map(c=>c.id===a.id?{...c,status:"error"}:c)),z.error(`Failed to compress ${a.file.name}`)}F(Math.round((t+1)/s.length*100))}if(r.length>1){const t=new ee;r.forEach(i=>t.file(i.name,i.buffer));const a=await t.generateAsync({type:"blob"});C(a)}S(!1),g(!0)},Z=s=>{l(r=>r.filter(t=>t.id!==s)),n.length<=1&&g(!1),u()};return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-4xl mx-auto px-6 py-6 md:py-10",children:[e.jsx(oe,{title:"Batch",highlight:"Shrinker",description:"Optimize multiple PDFs at once. Everything stays on your device."}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",ref:b,onChange:J}),n.length===0?e.jsxs("div",{onClick:()=>b.current?.click(),className:"border-4 border-dashed border-gray-200 dark:border-zinc-800 rounded-[2rem] md:rounded-[2.5rem] bg-white/50 dark:bg-zinc-900/50 p-10 md:p-20 text-center hover:border-rose-300 dark:hover:border-rose-900 hover:bg-rose-50/50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6 group-hover:scale-110 transition-transform",children:e.jsx(P,{size:32})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-1 md:mb-2 group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors",children:"Select PDFs"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-400 dark:text-zinc-500",children:"Drop files or tap to start batch compression"})]}):I?e.jsxs("div",{className:"space-y-6",children:[h&&n.length>1&&e.jsxs("a",{href:h,download:"paperknife-compressed-batch.zip",className:"block w-full bg-zinc-900 dark:bg-white text-white dark:text-black p-8 rounded-[2.5rem] text-center shadow-2xl transition-all hover:scale-[1.01] active:scale-95 group",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform",children:e.jsx(W,{className:"text-white",size:32})}),e.jsx("h3",{className:"text-2xl font-black tracking-tight mb-1",children:"Download All (ZIP)"}),e.jsxs("p",{className:"text-xs font-bold opacity-60 uppercase tracking-widest",children:[n.length," Optimized Documents"]})]}),h&&n.length===1&&e.jsx(ne,{message:"Success! File compressed.",downloadUrl:h,fileName:n[0].file.name.replace(".pdf","-compressed.pdf"),onStartOver:()=>{l([]),g(!1),u()}}),h&&n.length>1&&e.jsx("button",{onClick:()=>{l([]),g(!1),u()},className:"w-full py-4 text-gray-400 hover:text-rose-500 font-black uppercase tracking-[0.2em] text-xs transition-colors",children:"Start New Batch"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.map(s=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-gray-100 dark:border-zinc-800 flex items-center gap-4 relative group",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-zinc-800 rounded-lg overflow-hidden shrink-0",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(H,{className:"text-gray-300",size:16})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold truncate dark:text-white",children:s.file.name}),s.isLocked?e.jsx("div",{className:"flex gap-1 mt-1",children:e.jsx("input",{type:"password",placeholder:"Unlock...",className:"bg-gray-50 dark:bg-black text-[8px] p-1 rounded border border-gray-100 dark:border-zinc-800 outline-none w-20",onKeyDown:r=>{r.key==="Enter"&&R(s.id,r.currentTarget.value)}})}):e.jsxs("p",{className:"text-[10px] text-gray-400 font-bold",children:[(s.file.size/(1024*1024)).toFixed(2)," MB â€¢ ",s.pageCount," p"]})]}),e.jsx("button",{onClick:()=>Z(s.id),className:"p-1 text-gray-300 hover:text-rose-500",children:e.jsx(K,{size:14})})]},s.id)),e.jsxs("button",{onClick:()=>b.current?.click(),className:"border-2 border-dashed border-gray-100 dark:border-zinc-800 rounded-2xl p-4 text-gray-400 flex flex-col items-center justify-center gap-1 hover:border-rose-300 transition-all",children:[e.jsx(X,{size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter",children:"Add More"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-zinc-800 shadow-sm space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-4 flex items-center gap-2",children:[e.jsx(P,{size:12})," Compression Quality"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["high","medium","low"].map(s=>e.jsxs("button",{onClick:()=>$(s),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-1 ${y===s?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-zinc-800 hover:border-rose-200 dark:hover:border-rose-800"}`,children:[e.jsx("span",{className:`font-black uppercase text-[10px] ${y===s?"text-rose-500":"text-gray-400"}`,children:s}),e.jsx("span",{className:"text-[8px] text-gray-400 font-bold",children:s==="high"?"Max":s==="medium"?"Balanced":"Best"})]},s))})]}),w&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all duration-300",style:{width:`${D}%`}})}),e.jsxs("p",{className:"text-[10px] text-center font-black uppercase text-gray-400 tracking-widest animate-pulse",children:["Batch Progress: ",D,"%"]})]}),e.jsxs("button",{onClick:T,disabled:w||n.filter(s=>!s.isLocked).length===0,className:"w-full bg-rose-500 hover:bg-rose-600 text-white p-6 rounded-3xl shadow-xl shadow-rose-200 dark:shadow-none font-black text-xl tracking-tight transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3",children:[w?e.jsx(Y,{className:"animate-spin"}):e.jsx(P,{}),"Compress ",n.length," Files"]})]})]}),e.jsx(ie,{})]})})}export{ye as default};

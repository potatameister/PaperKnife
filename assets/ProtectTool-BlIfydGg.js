import{C as Y,j as s,a as J}from"./index-BprYyWo_.js";import{a1 as M,r as P,a2 as Q,l as E,$ as W,E as I,X as Z,Y as K}from"./vendor-ui-BR-XW_se.js";import{e as ee,P as T}from"./pdf-lib-core-B0uti0Qf.js";import{N as te,P as se,u as re,g as ae}from"./NativeToolLayout-8w2qwt7J.js";import{u as ne}from"./useObjectURL-CnrGu85N.js";import{S as oe}from"./SuccessState-Bn6iSuiS.js";import"./pdfjs-viewer-BENO9Ct1.js";const ce=M(ee);/**
 * pdf-encrypt-lite - Ultra-lightweight PDF encryption library
 * Powers PDFSmaller.com's PDF encryption tool
 * 
 * @author PDFSmaller.com (https://pdfsmaller.com)
 * @license MIT
 * @see https://pdfsmaller.com/protect-pdf - Try it online!
 * 
 * This minimal cryptographic implementation was built to solve the "impossible" 
 * problem of real PDF encryption within Cloudflare Workers' 1MB limit.
 * Total size: ~7KB for complete PDF encryption!
 */function ie(o){const r=typeof o=="string"?new TextEncoder().encode(o):o,a=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],e=new Uint32Array([3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745]);let t=1732584193,n=4023233417,c=2562383102,l=271733878;const d=r.length,g=d*8,x=d+9+63&-64,k=new Uint8Array(x);k.set(r),k[d]=128;const w=new DataView(k.buffer);w.setUint32(x-8,g,!0),w.setUint32(x-4,0,!0);for(let j=0;j<x;j+=64){const m=new Uint32Array(k.buffer,j,16);let u=t,h=n,p=c,b=l;for(let f=0;f<64;f++){let i,y;f<16?(i=h&p|~h&b,y=f):f<32?(i=b&h|~b&p,y=(5*f+1)%16):f<48?(i=h^p^b,y=(3*f+5)%16):(i=p^(h|~b),y=7*f%16),i=i+u+e[f]+m[y]>>>0,u=b,b=p,p=h,h=h+(i<<a[f]|i>>>32-a[f])>>>0}t=t+u>>>0,n=n+h>>>0,c=c+p>>>0,l=l+b>>>0}const v=new Uint8Array(16),F=new DataView(v.buffer);return F.setUint32(0,t,!0),F.setUint32(4,n,!0),F.setUint32(8,c,!0),F.setUint32(12,l,!0),v}let le=class{constructor(r){this.s=new Uint8Array(256),this.i=0,this.j=0;for(let e=0;e<256;e++)this.s[e]=e;let a=0;for(let e=0;e<256;e++)a=a+this.s[e]+r[e%r.length]&255,[this.s[e],this.s[a]]=[this.s[a],this.s[e]]}process(r){const a=new Uint8Array(r.length);for(let e=0;e<r.length;e++){this.i=this.i+1&255,this.j=this.j+this.s[this.i]&255,[this.s[this.i],this.s[this.j]]=[this.s[this.j],this.s[this.i]];const t=this.s[this.i]+this.s[this.j]&255;a[e]=r[e]^this.s[t]}return a}};function de(o){const r=new Uint8Array(o.length/2);for(let a=0;a<r.length;a++)r[a]=parseInt(o.substr(a*2,2),16);return r}function xe(o){return Array.from(o).map(r=>r.toString(16).padStart(2,"0")).join("")}const fe=Object.freeze(Object.defineProperty({__proto__:null,RC4:le,bytesToHex:xe,hexToBytes:de,md5:ie},Symbol.toStringTag,{value:"Module"})),ue=M(fe);/**
 * pdf-encrypt-lite - Ultra-lightweight PDF encryption library
 * Powers PDFSmaller.com's PDF encryption tool
 * 
 * @author PDFSmaller.com (https://pdfsmaller.com)
 * @license MIT
 * @see https://pdfsmaller.com/protect-pdf - Try it online!
 * 
 * This module implements PDF Standard Security Handler (Algorithm 2 & 3 from PDF spec)
 * Built to solve the "impossible" problem of real PDF encryption within edge constraints
 * 
 * Total size with crypto: ~7KB - when others are 2-20MB!
 * Battle-tested on thousands of PDFs at PDFSmaller.com
 */const{PDFDocument:he,PDFName:O,PDFHexString:U,PDFString:pe,PDFDict:H,PDFArray:be,PDFRawStream:ge,PDFNumber:A}=ce,{md5:S,RC4:C,hexToBytes:V,bytesToHex:N}=ue,D=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);function $(o){const r=new TextEncoder().encode(o),a=new Uint8Array(32);return r.length>=32?a.set(r.slice(0,32)):(a.set(r),a.set(D.slice(0,32-r.length),r.length)),a}function me(o,r,a,e){const t=$(o),n=new Uint8Array(t.length+r.length+4+e.length);let c=0;n.set(t,c),c+=t.length,n.set(r,c),c+=r.length,n[c++]=a&255,n[c++]=a>>8&255,n[c++]=a>>16&255,n[c++]=a>>24&255,n.set(e,c);let l=S(n);for(let d=0;d<50;d++)l=S(l.slice(0,16));return l.slice(0,16)}function ye(o,r){const a=$(o||r);let e=S(a);for(let c=0;c<50;c++)e=S(e);const t=$(r);let n=new Uint8Array(t);for(let c=0;c<20;c++){const l=new Uint8Array(e.length);for(let g=0;g<e.length;g++)l[g]=e[g]^c;n=new C(l.slice(0,16)).process(n)}return n}function we(o,r){const a=new Uint8Array(D.length+r.length);a.set(D),a.set(r,D.length);const e=S(a);let n=new C(o).process(e);for(let l=1;l<=19;l++){const d=new Uint8Array(o.length);for(let x=0;x<o.length;x++)d[x]=o[x]^l;n=new C(d).process(n)}const c=new Uint8Array(32);return c.set(n),c.set(new Uint8Array(16),16),c}function z(o,r,a,e){const t=new Uint8Array(e.length+5);t.set(e),t[e.length]=r&255,t[e.length+1]=r>>8&255,t[e.length+2]=r>>16&255,t[e.length+3]=a&255,t[e.length+4]=a>>8&255;const n=S(t);return new C(n.slice(0,Math.min(e.length+5,16))).process(o)}function R(o,r,a,e){if(o){if(o instanceof pe){const t=o.asBytes(),n=z(t,r,a,e);o.value=N(n)}else if(o instanceof U){const t=V(o.asString()),n=z(t,r,a,e);o.value=N(n)}else if(o instanceof H){const t=o.entries();for(const[n,c]of t){const l=n.asString();l!=="/Length"&&l!=="/Filter"&&l!=="/DecodeParms"&&R(c,r,a,e)}}else if(o instanceof be){const t=o.asArray();for(const n of t)R(n,r,a,e)}}}async function Fe(o,r,a=null){try{const e=await he.load(o,{ignoreEncryption:!0,updateMetadata:!1}),t=e.context;let n;const c=t.trailerInfo,l=c.ID;if(l&&Array.isArray(l)&&l.length>0){const u=l[0].toString().replace(/^<|>$/g,"");n=V(u)}else{const m=new Uint8Array(16);if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(m);else for(let p=0;p<16;p++)m[p]=Math.floor(Math.random()*256);n=m;const u=U.of(N(n)),h=U.of(N(n));c.ID=[u,h]}const d=4294967292,g=ye(a,r),x=me(r,g,d,n),k=we(x,n),w=t.enumerateIndirectObjects();for(const[m,u]of w){const h=m.objectNumber,p=m.generationNumber||0;if(u instanceof H){const b=u.get(O.of("Filter"));if(b&&b.asString()==="/Standard")continue}if(u instanceof ge){const b=u.contents,f=z(b,h,p,x);u.contents=f}R(u,h,p,x)}const v=t.obj({Filter:O.of("Standard"),V:A.of(2),R:A.of(3),Length:A.of(128),P:A.of(d),O:U.of(N(g)),U:U.of(N(k))}),F=t.register(v);return c.Encrypt=F,await e.save({useObjectStreams:!1})}catch(e){throw console.error("PDF encryption error:",e),new Error(`Failed to encrypt PDF: ${e.message}`)}}var ke=Fe;function Be(){const o=P.useRef(null),{objectUrl:r,createUrl:a,clearUrls:e}=ne(),[t,n]=P.useState(null),[c,l]=P.useState(!1),[d,g]=P.useState(""),[x,k]=P.useState(""),[w,v]=P.useState(""),[F,j]=P.useState("paperknife-protected"),m=Y.isNativePlatform(),u=async()=>{if(!t||!w)return;l(!0);const i=await re(t.file,w);i.success?(n({...t,isLocked:!1,thumbnail:i.thumbnail,pageCount:i.pageCount,sourcePassword:w}),j(`${t.file.name.replace(".pdf","")}-protected`)):I.error("Incorrect password"),l(!1)},h=async i=>{if(i.type!=="application/pdf")return;const y=await ae(i);n({file:i,thumbnail:y.thumbnail,pageCount:y.pageCount,isLocked:y.isLocked}),j(`${i.name.replace(".pdf","")}-protected`),e()},p=i=>{i.target.files?.[0]&&h(i.target.files[0])},b=async()=>{if(!(!t||!d||d!==x)){l(!0),await new Promise(i=>setTimeout(i,100));try{const i=await t.file.arrayBuffer(),y=await T.load(i,{password:t.sourcePassword||void 0,ignoreEncryption:!0}),B=await T.create();(await B.copyPages(y,y.getPageIndices())).forEach(G=>B.addPage(G));const _=await B.save(),q=await ke(_,d),L=new Blob([q],{type:"application/pdf"}),X=a(L);J({name:`${F||"protected"}.pdf`,tool:"Protect",size:L.size,resultUrl:X})}catch(i){I.error(`Failed: ${i.message}`)}finally{l(!1)}}},f=()=>s.jsx("button",{onClick:b,disabled:c||!d||d!==x,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${m?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:c?s.jsxs(s.Fragment,{children:[s.jsx(Z,{className:"animate-spin"})," Securing..."]}):s.jsxs(s.Fragment,{children:["Encrypt & Save ",s.jsx(K,{size:18})]})});return s.jsxs(te,{title:"Protect PDF",description:"Add strong encryption to your documents. Processed locally.",actions:t&&!t.isLocked&&!r&&s.jsx(f,{}),children:[s.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:o,onChange:p}),t?t.isLocked?s.jsx("div",{className:"max-w-md mx-auto",children:s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(E,{size:32})}),s.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),s.jsx("input",{type:"password",value:w,onChange:i=>v(i.target.value),placeholder:"Current Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),s.jsx("button",{onClick:u,disabled:!w||c,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase tracking-widest text-xs",children:c?"...":"Unlock"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[s.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:t.thumbnail?s.jsx("img",{src:t.thumbnail,className:"w-full h-full object-cover"}):s.jsx(E,{size:20})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:t.file.name}),s.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[t.pageCount," Pages • ",(t.file.size/(1024*1024)).toFixed(1)," MB"]})]}),s.jsx("button",{onClick:()=>n(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:s.jsx(W,{size:20})})]}),s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-3xl border border-gray-100 dark:border-white/5 space-y-6",children:[r?s.jsx(oe,{message:"Encrypted Successfully",downloadUrl:r,fileName:`${F||"protected"}.pdf`,onStartOver:()=>{e(),g(""),k("")}}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"New Password"}),s.jsx("input",{type:"password",value:d,onChange:i=>g(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm",placeholder:"••••••••"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Confirm Password"}),s.jsx("input",{type:"password",value:x,onChange:i=>k(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm",placeholder:"••••••••"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Filename"}),s.jsx("input",{type:"text",value:F,onChange:i=>j(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),!m&&s.jsx(f,{})]}),s.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-white/5 flex items-start gap-3",children:[s.jsx(E,{size:14,className:"text-amber-500 shrink-0 mt-0.5"}),s.jsx("p",{className:"text-[10px] text-amber-700 dark:text-amber-400 leading-relaxed",children:"PaperKnife cannot recover forgotten passwords. Save it securely."})]})]})]}):s.jsxs("div",{onClick:()=>o.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[s.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:s.jsx(Q,{size:32})}),s.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse files"})]}),s.jsx(se,{})]})}export{Be as default};

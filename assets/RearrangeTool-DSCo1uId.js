import{C as E,j as e,a as O}from"./index-DobvBlpI.js";import{r as c,a8 as U,l as $,a5 as T,z as P,V as A,X as B,a9 as M}from"./vendor-ui-D2qmvH7L.js";import{P as S}from"./pdf-lib-core-DzxZkFUh.js";import{u as K,a as C,D as _,c as G,S as V,r as W,s as X,K as q,P as H,b as J,d as Q,C as Y}from"./vendor-utils-BiJqw_qY.js";import{N as Z,P as ee,u as re,g as se,l as te,r as ae}from"./NativeToolLayout-jdULbXfN.js";import{S as oe}from"./SuccessState-BHamHYGy.js";import"./tesseract-core-C-2CBeSa.js";import"./pdfjs-viewer-BENO9Ct1.js";const ne=({pdfDoc:d,pageNum:s})=>{const[a,u]=c.useState(null),o=c.useRef(null);return c.useEffect(()=>{if(!d||a)return;const n=new IntersectionObserver(l=>{l[0].isIntersecting&&(ae(d,s,1).then(u),n.disconnect())},{rootMargin:"200px"});return o.current&&n.observe(o.current),()=>n.disconnect()},[d,s,a]),a?e.jsx("img",{src:a,className:"w-full h-full object-contain bg-white",alt:`P${s}`}):e.jsx("div",{ref:o,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function le({id:d,pageNum:s,pdfDoc:a}){const{attributes:u,listeners:o,setNodeRef:n,transform:l,transition:x,isDragging:p}=Q({id:d}),f={transform:Y.Transform.toString(l),transition:x,zIndex:p?50:0};return e.jsxs("div",{ref:n,style:f,...u,...o,className:`relative group cursor-grab active:cursor-grabbing aspect-[3/4] rounded-xl overflow-hidden border-2 transition-all bg-gray-50 dark:bg-black ${p?"border-rose-500 shadow-xl scale-105 opacity-90":"border-transparent hover:border-rose-500"}`,children:[e.jsx("div",{className:"w-full h-full p-2",children:e.jsx(ne,{pdfDoc:a,pageNum:s})}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 backdrop-blur-md rounded-lg p-1 text-white opacity-0 group-hover:opacity-100",children:e.jsx(M,{size:14})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[10px] font-bold text-white",children:["P. ",s]})]})}function be(){const d=c.useRef(null),[s,a]=c.useState(null),[u,o]=c.useState([]),[n,l]=c.useState(!1),[x,p]=c.useState(null),[f,h]=c.useState("paperknife-rearranged"),[b,D]=c.useState(""),j=E.isNativePlatform(),z=K(C(H),C(q,{coordinateGetter:X})),R=async()=>{if(!s||!b)return;l(!0);const r=await re(s.file,b);r.success?(a({...s,isLocked:!1,pageCount:r.pageCount,pdfDoc:r.pdfDoc,password:b}),o(Array.from({length:r.pageCount},(t,i)=>(i+1).toString())),h(`${s.file.name.replace(".pdf","")}-rearranged`)):P.error("Incorrect password"),l(!1)},F=async r=>{if(r.type==="application/pdf"){l(!0);try{const t=await se(r);if(t.isLocked)a({file:r,pageCount:0,isLocked:!0});else{const i=await te(r);a({file:r,pageCount:t.pageCount,isLocked:!1,pdfDoc:i}),o(Array.from({length:t.pageCount},(g,m)=>(m+1).toString())),h(`${r.name.replace(".pdf","")}-rearranged`)}}catch(t){console.error(t)}finally{l(!1),p(null)}}},L=r=>{const{active:t,over:i}=r;t.id!==i?.id&&(o(g=>{const m=g.indexOf(t.id),y=g.indexOf(i?.id);return J(g,m,y)}),p(null))},I=async()=>{if(s){l(!0),await new Promise(r=>setTimeout(r,100));try{const r=await s.file.arrayBuffer(),t=await S.load(r,{password:s.password||void 0,ignoreEncryption:!0}),i=await S.create(),g=u.map(w=>parseInt(w)-1);(await i.copyPages(t,g)).forEach(w=>i.addPage(w));const y=await i.save(),k=new Blob([y],{type:"application/pdf"}),N=URL.createObjectURL(k);p(N),O({name:`${f}.pdf`,tool:"Rearrange",size:k.size,resultUrl:N})}catch(r){P.error(`Error: ${r.message}`)}finally{l(!1)}}},v=()=>e.jsx("button",{onClick:I,disabled:n,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${j?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"animate-spin"})," Working..."]}):e.jsxs(e.Fragment,{children:["Save New Order ",e.jsx(B,{size:18})]})});return e.jsxs(Z,{title:"Rearrange PDF",description:"Drag and drop to reorder pages visually.",actions:s&&!s.isLocked&&!x&&e.jsx(v,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:d,onChange:r=>r.target.files?.[0]&&F(r.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx($,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:b,onChange:r=>D(r.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:R,disabled:!b||n,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-[10px] text-gray-400",children:"Drag to reorder"}),e.jsxs("button",{onClick:()=>o(Array.from({length:s.pageCount},(r,t)=>(t+1).toString())),className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-1",children:[e.jsx(T,{size:12})," Reset"]})]}),e.jsx(_,{sensors:z,collisionDetection:G,onDragEnd:L,children:e.jsx(V,{items:u,strategy:W,children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-1 scrollbar-hide",children:u.map(r=>e.jsx(le,{id:r,pageNum:parseInt(r),pdfDoc:s.pdfDoc},r))})})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm sticky top-24",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Filename"}),e.jsx("input",{type:"text",value:f,onChange:r=>h(r.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),x?e.jsx(oe,{message:"Rearranged Successfully!",downloadUrl:x,fileName:`${f}.pdf`,onStartOver:()=>p(null)}):!j&&e.jsx(v,{}),e.jsx("button",{onClick:()=>a(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})})})]}):e.jsxs("div",{onClick:()=>!n&&d.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(U,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start reordering"})]}),e.jsx(ee,{})]})}export{be as default};

import{C as $,j as e,a as O}from"./index-DnuRFOzk.js";import{r as a,q as C,l as M,$ as X,E as S,X as q,Y as H}from"./vendor-ui-I1uXdWR8.js";import{P as Y,S as G,d as J,r as K}from"./pdf-lib-core-CfWIYqAB.js";import{P as Q,u as V,g as Z}from"./PrivacyBadge-E3vy_G5K.js";import{S as _}from"./SuccessState-BCbx5pny.js";import{N as ee}from"./NativeToolLayout-BTUleJKs.js";import"./pdfjs-viewer-BENO9Ct1.js";function ce(){const g=a.useRef(null),[s,i]=a.useState(null),[l,o]=a.useState(!1),[d,p]=a.useState(null),[f,b]=a.useState("paperknife-watermarked"),[n,P]=a.useState(""),[c,z]=a.useState("CONFIDENTIAL"),[u,F]=a.useState(.3),[h]=a.useState(50),[L]=a.useState(-45),[k,T]=a.useState("#F43F5E"),y=$.isNativePlatform(),D=async()=>{if(!s||!n)return;o(!0);const t=await V(s.file,n);t.success?(i({...s,isLocked:!1,pageCount:t.pageCount,password:n}),b(`${s.file.name.replace(".pdf","")}-watermarked`)):S.error("Incorrect password"),o(!1)},B=async t=>{if(t.type==="application/pdf"){o(!0);try{const r=await Z(t);i({file:t,pageCount:r.pageCount,isLocked:r.isLocked}),b(`${t.name.replace(".pdf","")}-watermarked`)}catch(r){console.error(r)}finally{o(!1),p(null)}}},E=t=>{const r=parseInt(t.slice(1,3),16)/255,x=parseInt(t.slice(3,5),16)/255,m=parseInt(t.slice(5,7),16)/255;return K(r,x,m)},I=async()=>{if(s){o(!0),await new Promise(t=>setTimeout(t,100));try{const t=await s.file.arrayBuffer(),r=await Y.load(t,{password:s.password||void 0,ignoreEncryption:!0}),x=await r.embedFont(G.HelveticaBold),m=r.getPages(),U=E(k);m.forEach(N=>{const{width:A,height:R}=N.getSize();N.drawText(c,{x:A/2-c.length*h/4,y:R/2,size:h,font:x,color:U,opacity:u,rotate:J(L)})});const W=await r.save(),j=new Blob([W],{type:"application/pdf"}),v=URL.createObjectURL(j);p(v),O({name:`${f}.pdf`,tool:"Watermark",size:j.size,resultUrl:v})}catch(t){S.error(`Error: ${t.message}`)}finally{o(!1)}}},w=()=>e.jsx("button",{onClick:I,disabled:l||!c,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${y?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"animate-spin"})," Working..."]}):e.jsxs(e.Fragment,{children:["Apply Watermark ",e.jsx(H,{size:18})]})});return e.jsxs(ee,{title:"Watermark",description:"Add secure text overlays to your documents locally.",actions:s&&!s.isLocked&&!d&&e.jsx(w,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:g,onChange:t=>t.target.files?.[0]&&B(t.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(M,{size:32})}),e.jsx("input",{type:"password",value:n,onChange:t=>P(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:D,disabled:!n||l,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"w-12 h-12 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-xl flex items-center justify-center shrink-0",children:e.jsx(C,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:s.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[s.pageCount," Pages â€¢ ",(s.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>i(null),className:"p-2 text-gray-400 hover:text-rose-500",children:e.jsx(X,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-6",children:d?e.jsx(_,{message:"Watermark Applied!",downloadUrl:d,fileName:`${f}.pdf`,onStartOver:()=>p(null)}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Watermark Text"}),e.jsx("input",{type:"text",value:c,onChange:t=>z(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:["Opacity (",Math.round(u*100),"%)"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:u,onChange:t=>F(parseFloat(t.target.value)),className:"w-full accent-rose-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Color"}),e.jsx("input",{type:"color",value:k,onChange:t=>T(t.target.value),className:"w-full h-8 bg-transparent border-none cursor-pointer"})]})]}),!y&&e.jsx(w,{})]})})]}):e.jsxs("div",{onClick:()=>!l&&g.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(C,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start watermarking"})]}),e.jsx(Q,{})]})}export{ce as default};

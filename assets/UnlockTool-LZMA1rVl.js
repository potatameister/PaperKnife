import{u as P,j as e,a as F}from"./index-CqnREVVI.js";import{r as a,o as h,l as D,X as L,a2 as U,G as z}from"./vendor-ui-C2hlGh6M.js";import{P as C}from"./pdf-lib-core-C1d7PD49.js";import{g as S,P as E,u as B}from"./PrivacyBadge-HaX4DNlE.js";import{u as R}from"./useObjectURL-JR8IFxD3.js";import{S as O}from"./SuccessState-1lSBI22J.js";import{N as T}from"./NativeToolLayout-CC2e3_8u.js";import"./pdfjs-viewer-BENO9Ct1.js";function K(){const d=a.useRef(null),{consumePipelineFile:g}=P(),{objectUrl:l,createUrl:k,clearUrls:p}=R(),[r,n]=a.useState(null),[u,m]=a.useState(!1),[o,c]=a.useState(""),[i,x]=a.useState("paperknife-unlocked");a.useEffect(()=>{const t=g();if(t){const s=new File([t.buffer],t.name,{type:"application/pdf"});f(s)}},[]);const f=async t=>{if(t.type!=="application/pdf")return;const s=await S(t);n({file:t,thumbnail:s.thumbnail,pageCount:s.pageCount,isLocked:s.isLocked}),x(`${t.name.replace(".pdf","")}-unlocked`),p(),c("")},w=t=>{t.target.files?.[0]&&f(t.target.files[0])},y=async()=>{if(!(!r||r.isLocked&&!o)){m(!0),await new Promise(t=>setTimeout(t,100));try{if(!(await B(r.file,o)).success)throw new Error("Incorrect password.");const s=await r.file.arrayBuffer(),v=await(await C.load(s,{password:o||void 0,ignoreEncryption:!0})).save(),b=new Blob([v],{type:"application/pdf"}),N=k(b);F({name:`${i||"unlocked"}.pdf`,tool:"Unlock",size:b.size,resultUrl:N})}catch(t){z.error(t.message||"Error.")}finally{m(!1)}}},j=()=>e.jsxs("button",{onClick:y,disabled:u||r?.isLocked&&!o,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20",children:[u?e.jsx(U,{className:"animate-spin"}):e.jsx(h,{size:20})," Unlock PDF"]});return e.jsxs(T,{title:"Unlock PDF",description:"Remove passwords and restrictions permanently. Processed locally.",actions:r&&!l&&e.jsx(j,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:d,onChange:w}),r?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500 shadow-inner",children:r.thumbnail?e.jsx("img",{src:r.thumbnail,className:"w-full h-full object-cover"}):e.jsx(D,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:r.file.name}),e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:r.isLocked?"Encrypted Document":"Open Document"})]}),e.jsx("button",{onClick:()=>n(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(L,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-6 shadow-sm",children:l?e.jsx(O,{message:"Encryption Removed!",downloadUrl:l,fileName:`${i||"unlocked"}.pdf`,onStartOver:()=>{p(),c(""),n(null)}}):e.jsxs("div",{className:"space-y-6",children:[r.isLocked?e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Master Password"}),e.jsx("input",{type:"password",value:o,onChange:t=>c(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-lg text-center dark:text-white",placeholder:"••••••••",autoFocus:!0})]}):e.jsx("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/10 rounded-xl border border-emerald-100 dark:border-emerald-900/20 text-center",children:e.jsx("p",{className:"text-emerald-600 dark:text-emerald-400 font-bold text-xs uppercase tracking-widest",children:"File is already unlocked!"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:i,onChange:t=>x(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]})]})})]}):e.jsxs("div",{onClick:()=>d.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(h,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select Locked PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse files"})]}),e.jsx(E,{})]})}export{K as default};

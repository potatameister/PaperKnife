import{C as A,j as e,a as E}from"./index-nrP_i5HM.js";import{r as i,ab as S,l as F,I as K,$ as T,E as z,X as D,ac as $}from"./vendor-ui-BrB8L0Ll.js";import{P as p}from"./pdf-lib-core-DO6oD13o.js";import{P as R,u as O,g as X}from"./PrivacyBadge-DHQUhzMb.js";import{S as q}from"./SuccessState-D5TpKA5k.js";import{N as G}from"./NativeToolLayout-BYNydltX.js";import"./pdfjs-viewer-BENO9Ct1.js";function _(){const w=i.useRef(null),[s,x]=i.useState(null),[d,n]=i.useState(!1),[f,m]=i.useState(null),[y,L]=i.useState("paperknife-metadata"),[u,B]=i.useState(""),[g,j]=i.useState(!1),[l,b]=i.useState({title:"",author:localStorage.getItem("defaultAuthor")||"",subject:"",keywords:"",creator:localStorage.getItem("defaultAuthor")||"PaperKnife",producer:localStorage.getItem("defaultAuthor")||"PaperKnife"}),h=A.isNativePlatform(),M=async()=>{if(!s||!u)return;n(!0);const t=await O(s.file,u);if(t.success){const r=await s.file.arrayBuffer(),o=await p.load(r,{password:u}),a={title:o.getTitle()||"",author:o.getAuthor()||"",subject:o.getSubject()||"",keywords:o.getKeywords()||"",creator:o.getCreator()||"",producer:o.getProducer()||""};x({...s,isLocked:!1,pageCount:t.pageCount,password:u,currentMeta:a}),b(a)}else z.error("Incorrect password");n(!1)},I=async t=>{if(t.type==="application/pdf"){n(!0);try{const r=await X(t);let o={title:"",author:"",subject:"",keywords:"",creator:"",producer:""};if(!r.isLocked){const a=await t.arrayBuffer(),c=await p.load(a);o={title:c.getTitle()||"",author:c.getAuthor()||"",subject:c.getSubject()||"",keywords:c.getKeywords()||"",creator:c.getCreator()||"",producer:c.getProducer()||""}}x({file:t,pageCount:r.pageCount,isLocked:r.isLocked,currentMeta:o}),b(o),L(`${t.name.replace(".pdf","")}-metadata`)}catch(r){console.error(r)}finally{n(!1),m(null)}}},k=async(t=!1)=>{if(s){n(!0),t&&j(!0),await new Promise(r=>setTimeout(r,300));try{const r=await s.file.arrayBuffer(),o=await p.load(r,{password:s.password||void 0,ignoreEncryption:!0});let a;t?(a=await p.create(),(await a.copyPages(o,o.getPageIndices())).forEach(U=>a.addPage(U))):a=o,a.setTitle(l.title),a.setAuthor(l.author),a.setSubject(l.subject),a.setKeywords(l.keywords.split(",").map(C=>C.trim())),a.setCreator(l.creator||"PaperKnife"),a.setProducer(l.producer||"PaperKnife");const c=await a.save(),N=new Blob([c],{type:"application/pdf"}),P=URL.createObjectURL(N);m(P),E({name:`${y}.pdf`,tool:"Metadata",size:N.size,resultUrl:P})}catch(r){z.error(`Error: ${r.message}`)}finally{n(!1),j(!1)}}},v=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{onClick:()=>k(!1),disabled:d,className:`w-full bg-rose-500 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${h?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:[d&&!g?e.jsx(D,{className:"animate-spin"}):e.jsx(S,{size:18})," Update Metadata"]}),e.jsxs("button",{onClick:()=>k(!0),disabled:d,className:`w-full bg-emerald-500 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-emerald-500/20 ${h?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:[g?e.jsx(D,{className:"animate-spin"}):e.jsx($,{size:18})," Privacy Deep Clean"]})]});return e.jsxs(G,{title:"Metadata Editor",description:"Edit or wipe document properties for better privacy.",actions:s&&!s.isLocked&&!f&&e.jsx(v,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:w,onChange:t=>t.target.files?.[0]&&I(t.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(F,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"File Protected"}),e.jsx("input",{type:"password",value:u,onChange:t=>B(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:M,disabled:!u||d,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:d?"...":"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-2xl flex items-center justify-center shrink-0",children:e.jsx(K,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:s.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[s.pageCount," Pages â€¢ ",(s.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>x(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(T,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-3xl border border-gray-100 dark:border-white/5 space-y-6",children:f?e.jsx(q,{message:g?"Deep Clean Successful!":"Metadata Updated!",downloadUrl:f,fileName:`${y}.pdf`,onStartOver:()=>m(null)}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[["title","author","subject","keywords","creator","producer"].map(t=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:t}),e.jsx("input",{type:"text",value:l[t],onChange:r=>b({...l,[t]:r.target.value}),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]},t)),!h&&e.jsx("div",{className:"md:col-span-2 mt-4",children:e.jsx(v,{})})]})})]}):e.jsxs("div",{onClick:()=>!d&&w.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(S,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start editing metadata"})]}),e.jsx(R,{})]})}export{_ as default};

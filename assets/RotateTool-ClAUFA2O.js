import{u as U,j as e,a as A}from"./index-DVQ_-K-e.js";import{r as o,J as u,p as B,X as $,a7 as I,t as P,a2 as O}from"./vendor-ui-DVJtqS_b.js";import{P as M,d as G}from"./pdf-lib-core-oHZ1rFIz.js";import{g as J,l as V,P as X,u as _,r as q}from"./PrivacyBadge-BptljzUF.js";import{S as H}from"./SuccessState-R0HWCMze.js";import{N as K}from"./NativeToolLayout-Bywg2nrF.js";import"./pdfjs-viewer-BENO9Ct1.js";const Q=({pdfDoc:d,pageNum:x,rotation:s})=>{const[a,p]=o.useState(null),n=o.useRef(null);return o.useEffect(()=>{if(!d||a)return;const l=new IntersectionObserver(i=>{i[0].isIntersecting&&(q(d,x,1).then(p),l.disconnect())},{rootMargin:"200px"});return n.current&&l.observe(n.current),()=>l.disconnect()},[d,x,a]),a?e.jsx("img",{src:a,className:"w-full h-full object-contain transition-transform duration-300 bg-white",style:{transform:`rotate(${s}deg)`},alt:`P${x}`}):e.jsx("div",{ref:n,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function ae(){const d=o.useRef(null),{consumePipelineFile:x}=U(),[s,a]=o.useState(null),[p,n]=o.useState({}),[l,i]=o.useState(!1),[f,m]=o.useState(null),[h,g]=o.useState("paperknife-rotated"),[b,C]=o.useState("");o.useEffect(()=>{const t=x();if(t){const r=new File([t.buffer],t.name,{type:"application/pdf"});j(r)}},[]);const z=async()=>{if(!s||!b)return;i(!0);const t=await _(s.file,b);t.success?(a({...s,isLocked:!1,pageCount:t.pageCount,pdfDoc:t.pdfDoc,password:b,thumbnail:t.thumbnail}),g(`${s.file.name.replace(".pdf","")}-rotated`)):P.error("Incorrect password"),i(!1)},j=async t=>{if(t.type==="application/pdf"){i(!0);try{const r=await J(t);if(r.isLocked)a({file:t,pageCount:0,isLocked:!0});else{const c=await V(t);a({file:t,pageCount:r.pageCount,isLocked:!1,pdfDoc:c,thumbnail:r.thumbnail}),g(`${t.name.replace(".pdf","")}-rotated`),n({})}}catch(r){console.error(r)}finally{i(!1),m(null)}}},R=t=>{n(r=>({...r,[t]:((r[t]||0)+90)%360})),m(null)},D=()=>{const t={...p};for(let r=1;r<=(s?.pageCount||0);r++)t[r]=((t[r]||0)+90)%360;n(t),m(null)},F=async()=>{if(s){i(!0),await new Promise(t=>setTimeout(t,100));try{const t=await s.file.arrayBuffer(),r=await M.load(t,{password:s.password||void 0,ignoreEncryption:!0});r.getPages().forEach((v,L)=>{const E=L+1,N=p[E]||0;if(N!==0){const T=v.getRotation().angle;v.setRotation(G((T+N)%360))}});const w=await r.save(),k=new Blob([w],{type:"application/pdf"}),y=URL.createObjectURL(k);m(y),A({name:`${h}.pdf`,tool:"Rotate",size:k.size,resultUrl:y})}catch(t){P.error(`Error: ${t.message}`)}finally{i(!1)}}},S=()=>e.jsxs("button",{onClick:F,disabled:l,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl",children:[l?e.jsx(O,{className:"animate-spin"}):e.jsx(u,{size:20})," Save Rotated PDF"]});return e.jsxs(K,{title:"Rotate PDF",description:"Tap individual pages to rotate 90 degrees.",actions:s&&!s.isLocked&&!f&&e.jsx(S,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:d,onChange:t=>t.target.files?.[0]&&j(t.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto relative z-[100]",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center shadow-2xl",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(B,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:b,onChange:t=>C(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4 dark:text-white"}),e.jsx("button",{onClick:z,disabled:!b||l,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6 shadow-sm",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500 shadow-inner",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,className:"w-full h-full object-cover"}):e.jsx(u,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:s.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[s.pageCount," Pages • ",(s.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>a(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx($,{size:20})})]}),e.jsxs("div",{className:"bg-rose-500/5 dark:bg-rose-500/10 border border-rose-500/20 rounded-2xl p-4 flex items-center gap-4 animate-pulse",children:[e.jsx("div",{className:"w-10 h-10 bg-rose-500 text-white rounded-full flex items-center justify-center shrink-0 shadow-lg shadow-rose-500/20",children:e.jsx(u,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-black text-rose-500 uppercase tracking-tight leading-none mb-1",children:"Visual Editor"}),e.jsx("p",{className:"text-xs text-rose-500/70 font-bold",children:"Tap any page thumbnail below to rotate it 90° clockwise."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-[10px] text-gray-400",children:"Page Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:D,className:"text-[10px] font-black uppercase text-rose-500 flex items-center gap-1 font-bold",children:[e.jsx(u,{size:12})," All"]}),e.jsxs("button",{onClick:()=>n({}),className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-1 font-bold",children:[e.jsx(I,{size:12})," Reset"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-1 scrollbar-hide",children:Array.from({length:s.pageCount}).map((t,r)=>{const c=r+1,w=p[c]||0;return e.jsxs("div",{onClick:()=>R(c),className:"relative group cursor-pointer aspect-[3/4] rounded-xl overflow-hidden border-2 border-transparent hover:border-rose-500 transition-all bg-gray-50 dark:bg-black shadow-sm",children:[e.jsx("div",{className:"w-full h-full p-2",children:e.jsx(Q,{pdfDoc:s.pdfDoc,pageNum:c,rotation:w})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/5 transition-colors",children:e.jsx("div",{className:"bg-white dark:bg-zinc-800 text-rose-500 p-2 rounded-full opacity-0 group-hover:opacity-100 shadow-xl scale-75 group-hover:scale-100 transition-all border border-gray-100 dark:border-white/5",children:e.jsx(u,{size:20})})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[9px] font-black text-white",children:["PAGE ",c]})]},c)})})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm space-y-6",children:[f?e.jsx(H,{message:"PDF Rotated Successfully!",downloadUrl:f,fileName:`${h}.pdf`,onStartOver:()=>{m(null),a(null)}}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:h,onChange:t=>g(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]})}),e.jsx("button",{onClick:()=>a(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})]}):e.jsxs("div",{onClick:()=>!l&&d.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(u,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start rotating"})]}),e.jsx(X,{})]})}export{ae as default};

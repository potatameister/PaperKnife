import{u as Q,C as W,j as s,a as Y}from"./index-CrqUSg-E.js";import{a6 as H,r as v,q as Z,p as $,X as K,t as O,a2 as ee,a3 as te}from"./vendor-ui-D7-yJfeG.js";import{e as se,P as T}from"./pdf-lib-core-D4Eo6sTa.js";import{g as re,P as ae,u as ne}from"./PrivacyBadge-BHcAHnXd.js";import{u as oe}from"./useObjectURL-D_4zXYKL.js";import{S as ce}from"./SuccessState-xd4KAoMP.js";import{N as ie}from"./NativeToolLayout-BiYB0yh8.js";import"./pdfjs-viewer-BENO9Ct1.js";const le=H(se);/**
 * pdf-encrypt-lite - Ultra-lightweight PDF encryption library
 * Powers PDFSmaller.com's PDF encryption tool
 * 
 * @author PDFSmaller.com (https://pdfsmaller.com)
 * @license MIT
 * @see https://pdfsmaller.com/protect-pdf - Try it online!
 * 
 * This minimal cryptographic implementation was built to solve the "impossible" 
 * problem of real PDF encryption within Cloudflare Workers' 1MB limit.
 * Total size: ~7KB for complete PDF encryption!
 */function de(n){const r=typeof n=="string"?new TextEncoder().encode(n):n,a=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],t=new Uint32Array([3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745]);let c=1732584193,e=4023233417,o=2562383102,l=271733878;const d=r.length,x=d*8,u=d+9+63&-64,y=new Uint8Array(u);y.set(r),y[d]=128;const N=new DataView(y.buffer);N.setUint32(u-8,x,!0),N.setUint32(u-4,0,!0);for(let j=0;j<u;j+=64){const m=new Uint32Array(y.buffer,j,16);let p=c,h=e,f=o,g=l;for(let b=0;b<64;b++){let k,i;b<16?(k=h&f|~h&g,i=b):b<32?(k=g&h|~g&f,i=(5*b+1)%16):b<48?(k=h^f^g,i=(3*b+5)%16):(k=f^(h|~g),i=7*b%16),k=k+p+t[b]+m[i]>>>0,p=g,g=f,f=h,h=h+(k<<a[b]|k>>>32-a[b])>>>0}c=c+p>>>0,e=e+h>>>0,o=o+f>>>0,l=l+g>>>0}const w=new Uint8Array(16),F=new DataView(w.buffer);return F.setUint32(0,c,!0),F.setUint32(4,e,!0),F.setUint32(8,o,!0),F.setUint32(12,l,!0),w}let xe=class{constructor(r){this.s=new Uint8Array(256),this.i=0,this.j=0;for(let t=0;t<256;t++)this.s[t]=t;let a=0;for(let t=0;t<256;t++)a=a+this.s[t]+r[t%r.length]&255,[this.s[t],this.s[a]]=[this.s[a],this.s[t]]}process(r){const a=new Uint8Array(r.length);for(let t=0;t<r.length;t++){this.i=this.i+1&255,this.j=this.j+this.s[this.i]&255,[this.s[this.i],this.s[this.j]]=[this.s[this.j],this.s[this.i]];const c=this.s[this.i]+this.s[this.j]&255;a[t]=r[t]^this.s[c]}return a}};function fe(n){const r=new Uint8Array(n.length/2);for(let a=0;a<r.length;a++)r[a]=parseInt(n.substr(a*2,2),16);return r}function ue(n){return Array.from(n).map(r=>r.toString(16).padStart(2,"0")).join("")}const pe=Object.freeze(Object.defineProperty({__proto__:null,RC4:xe,bytesToHex:ue,hexToBytes:fe,md5:de},Symbol.toStringTag,{value:"Module"})),he=H(pe);/**
 * pdf-encrypt-lite - Ultra-lightweight PDF encryption library
 * Powers PDFSmaller.com's PDF encryption tool
 * 
 * @author PDFSmaller.com (https://pdfsmaller.com)
 * @license MIT
 * @see https://pdfsmaller.com/protect-pdf - Try it online!
 * 
 * This module implements PDF Standard Security Handler (Algorithm 2 & 3 from PDF spec)
 * Built to solve the "impossible" problem of real PDF encryption within edge constraints
 * 
 * Total size with crypto: ~7KB - when others are 2-20MB!
 * Battle-tested on thousands of PDFs at PDFSmaller.com
 */const{PDFDocument:be,PDFName:M,PDFHexString:A,PDFString:ge,PDFDict:V,PDFArray:me,PDFRawStream:ye,PDFNumber:D}=le,{md5:U,RC4:B,hexToBytes:_,bytesToHex:S}=he,C=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);function z(n){const r=new TextEncoder().encode(n),a=new Uint8Array(32);return r.length>=32?a.set(r.slice(0,32)):(a.set(r),a.set(C.slice(0,32-r.length),r.length)),a}function we(n,r,a,t){const c=z(n),e=new Uint8Array(c.length+r.length+4+t.length);let o=0;e.set(c,o),o+=c.length,e.set(r,o),o+=r.length,e[o++]=a&255,e[o++]=a>>8&255,e[o++]=a>>16&255,e[o++]=a>>24&255,e.set(t,o);let l=U(e);for(let d=0;d<50;d++)l=U(l.slice(0,16));return l.slice(0,16)}function ke(n,r){const a=z(n||r);let t=U(a);for(let o=0;o<50;o++)t=U(t);const c=z(r);let e=new Uint8Array(c);for(let o=0;o<20;o++){const l=new Uint8Array(t.length);for(let x=0;x<t.length;x++)l[x]=t[x]^o;e=new B(l.slice(0,16)).process(e)}return e}function Fe(n,r){const a=new Uint8Array(C.length+r.length);a.set(C),a.set(r,C.length);const t=U(a);let e=new B(n).process(t);for(let l=1;l<=19;l++){const d=new Uint8Array(n.length);for(let u=0;u<n.length;u++)d[u]=n[u]^l;e=new B(d).process(e)}const o=new Uint8Array(32);return o.set(e),o.set(new Uint8Array(16),16),o}function R(n,r,a,t){const c=new Uint8Array(t.length+5);c.set(t),c[t.length]=r&255,c[t.length+1]=r>>8&255,c[t.length+2]=r>>16&255,c[t.length+3]=a&255,c[t.length+4]=a>>8&255;const e=U(c);return new B(e.slice(0,Math.min(t.length+5,16))).process(n)}function L(n,r,a,t){if(n){if(n instanceof ge){const c=n.asBytes(),e=R(c,r,a,t);n.value=S(e)}else if(n instanceof A){const c=_(n.asString()),e=R(c,r,a,t);n.value=S(e)}else if(n instanceof V){const c=n.entries();for(const[e,o]of c){const l=e.asString();l!=="/Length"&&l!=="/Filter"&&l!=="/DecodeParms"&&L(o,r,a,t)}}else if(n instanceof me){const c=n.asArray();for(const e of c)L(e,r,a,t)}}}async function je(n,r,a=null){try{const t=await be.load(n,{ignoreEncryption:!0,updateMetadata:!1}),c=t.context;let e;const o=c.trailerInfo,l=o.ID;if(l&&Array.isArray(l)&&l.length>0){const p=l[0].toString().replace(/^<|>$/g,"");e=_(p)}else{const m=new Uint8Array(16);if(typeof crypto<"u"&&crypto.getRandomValues)crypto.getRandomValues(m);else for(let f=0;f<16;f++)m[f]=Math.floor(Math.random()*256);e=m;const p=A.of(S(e)),h=A.of(S(e));o.ID=[p,h]}const d=4294967292,x=ke(a,r),u=we(r,x,d,e),y=Fe(u,e),N=c.enumerateIndirectObjects();for(const[m,p]of N){const h=m.objectNumber,f=m.generationNumber||0;if(p instanceof V){const g=p.get(M.of("Filter"));if(g&&g.asString()==="/Standard")continue}if(p instanceof ye){const g=p.contents,b=R(g,h,f,u);p.contents=b}L(p,h,f,u)}const w=c.obj({Filter:M.of("Standard"),V:D.of(2),R:D.of(3),Length:D.of(128),P:D.of(d),O:A.of(S(x)),U:A.of(S(y))}),F=c.register(w);return o.Encrypt=F,await t.save({useObjectStreams:!1})}catch(t){throw console.error("PDF encryption error:",t),new Error(`Failed to encrypt PDF: ${t.message}`)}}var Pe=je;function ze(){const n=v.useRef(null),{consumePipelineFile:r}=Q(),{objectUrl:a,createUrl:t,clearUrls:c}=oe(),[e,o]=v.useState(null),[l,d]=v.useState(!1),[x,u]=v.useState(""),[y,N]=v.useState(""),[w,F]=v.useState(""),[j,m]=v.useState("paperknife-protected"),p=W.isNativePlatform();v.useEffect(()=>{const i=r();if(i){const P=new File([i.buffer],i.name,{type:"application/pdf"});f(P)}},[]);const h=async()=>{if(!e||!w)return;d(!0);const i=await ne(e.file,w);i.success?(o({...e,isLocked:!1,thumbnail:i.thumbnail,pageCount:i.pageCount,sourcePassword:w}),m(`${e.file.name.replace(".pdf","")}-protected`)):O.error("Incorrect password"),d(!1)},f=async i=>{if(i.type!=="application/pdf")return;const P=await re(i);o({file:i,thumbnail:P.thumbnail,pageCount:P.pageCount,isLocked:P.isLocked}),m(`${i.name.replace(".pdf","")}-protected`),c()},g=i=>{i.target.files?.[0]&&f(i.target.files[0])},b=async()=>{if(!(!e||!x||x!==y)){d(!0),await new Promise(i=>setTimeout(i,100));try{const i=await e.file.arrayBuffer(),P=await T.load(i,{password:e.sourcePassword||void 0,ignoreEncryption:!0}),E=await T.create();(await E.copyPages(P,P.getPageIndices())).forEach(J=>E.addPage(J));const q=await E.save(),G=await Pe(q,x),I=new Blob([G],{type:"application/pdf"}),X=t(I);Y({name:`${j||"protected"}.pdf`,tool:"Protect",size:I.size,resultUrl:X})}catch(i){O.error(`Failed: ${i.message}`)}finally{d(!1)}}},k=()=>s.jsx("button",{onClick:b,disabled:l||!x||x!==y,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${p?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:l?s.jsxs(s.Fragment,{children:[s.jsx(ee,{className:"animate-spin"})," Securing..."]}):s.jsxs(s.Fragment,{children:["Encrypt & Save ",s.jsx(te,{size:18})]})});return s.jsxs(ie,{title:"Protect PDF",description:"Add strong encryption to your documents. Processed locally.",actions:e&&!e.isLocked&&!a&&s.jsx(k,{}),children:[s.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:n,onChange:g}),e?e.isLocked?s.jsx("div",{className:"max-w-md mx-auto",children:s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[s.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx($,{size:32})}),s.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),s.jsx("input",{type:"password",value:w,onChange:i=>F(i.target.value),placeholder:"Current Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),s.jsx("button",{onClick:h,disabled:!w||l,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase tracking-widest text-xs",children:l?"...":"Unlock"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[s.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:e.thumbnail?s.jsx("img",{src:e.thumbnail,className:"w-full h-full object-cover"}):s.jsx($,{size:20})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:e.file.name}),s.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black tracking-widest",children:[e.pageCount," Pages • ",(e.file.size/(1024*1024)).toFixed(1)," MB"]})]}),s.jsx("button",{onClick:()=>o(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:s.jsx(K,{size:20})})]}),s.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-3xl border border-gray-100 dark:border-white/5 space-y-6 shadow-sm",children:[a?s.jsx(ce,{message:"Encrypted Successfully",downloadUrl:a,fileName:`${j||"protected"}.pdf`,onStartOver:()=>{c(),u(""),N(""),o(null)}}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest px-1",children:"New Password"}),s.jsx("input",{type:"password",value:x,onChange:i=>u(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white",placeholder:"••••••••"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest px-1",children:"Confirm Password"}),s.jsx("input",{type:"password",value:y,onChange:i=>N(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white",placeholder:"••••••••"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2 tracking-widest px-1",children:"Output Filename"}),s.jsx("input",{type:"text",value:j,onChange:i=>m(i.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm dark:text-white"})]})]}),s.jsxs("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-white/5 flex items-start gap-3",children:[s.jsx($,{size:14,className:"text-amber-500 shrink-0 mt-0.5"}),s.jsx("p",{className:"text-[10px] text-amber-700 dark:text-amber-400 leading-relaxed font-medium",children:"PaperKnife cannot recover forgotten passwords. Save it securely."})]}),s.jsx("button",{onClick:()=>o(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})]}):s.jsxs("div",{onClick:()=>n.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[s.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:s.jsx(Z,{size:32})}),s.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse files"})]}),s.jsx(ae,{})]})}export{ze as default};

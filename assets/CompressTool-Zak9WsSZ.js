import{u as _,C as q,j as e,a as J}from"./index-Ehi60uMI.js";import{r as d,Z as V,K as W,_ as G,P as Y,D as H,E as ee,V as se,X as te,a2 as ae,a3 as re,h as ie}from"./vendor-ui-6e87KQdg.js";import{J as $}from"./vendor-utils-_fjEc3H4.js";import{g as ne,N as le,P as oe,u as ce,d as de,l as A,r as I}from"./NativeToolLayout-Hd3vf7rB.js";import{u as pe}from"./useObjectURL-Bbd_KjOG.js";import{S as ue}from"./SuccessState-BbA2S7kT.js";import"./tesseract-core-DjdWK_Ru.js";import"./pdfjs-viewer-BENO9Ct1.js";const me=({originalBuffer:w,compressedBuffer:C})=>{const[z,y]=d.useState(""),[f,S]=d.useState(""),[j,n]=d.useState(50),o=d.useRef(null);d.useEffect(()=>{(async()=>{try{const u=await A(new File([w],"orig.pdf",{type:"application/pdf"})),N=await A(new File([C],"comp.pdf",{type:"application/pdf"})),x=await I(u,1,2),M=await I(N,1,2);y(x),S(M)}catch(u){console.error(u)}})()},[w,C]);const k=g=>{if(!o.current)return;const u=o.current.getBoundingClientRect(),x=(("touches"in g?g.touches[0].clientX:g.clientX)-u.left)/u.width*100;n(Math.max(0,Math.min(100,x)))};return!z||!f?e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center bg-gray-50 dark:bg-zinc-900 rounded-3xl animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-rose-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400",children:"Rendering Comparison..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center px-2",children:e.jsxs("h4",{className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-2",children:[e.jsx(ae,{size:12})," Quality Inspection"]})}),e.jsxs("div",{ref:o,className:"relative h-80 md:h-[400px] rounded-[2rem] overflow-hidden cursor-ew-resize select-none border border-gray-100 dark:border-white/5",onMouseMove:k,onTouchMove:k,children:[e.jsx("img",{src:f,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Compressed"}),e.jsx("div",{className:"absolute inset-0 w-full h-full overflow-hidden",style:{clipPath:`inset(0 ${100-j}% 0 0)`},children:e.jsx("img",{src:z,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Original"})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-xl z-10",style:{left:`${j}%`},children:e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-8 h-8 bg-white dark:bg-zinc-900 rounded-full shadow-2xl border border-gray-100 dark:border-white/5 flex items-center justify-center text-rose-500",children:[e.jsx(re,{size:14}),e.jsx(ie,{size:14})]})})]})]})};function Ne(){const w=d.useRef(null),{consumePipelineFile:C,setPipelineFile:z,lastPipelinedFile:y}=_(),{objectUrl:f,createUrl:S,clearUrls:j}=pe(),[n,o]=d.useState([]),[k,g]=d.useState(!1),[u,N]=d.useState(0),[x,M]=d.useState("medium"),[R,P]=d.useState(!1),F=q.isNativePlatform();d.useEffect(()=>{const s=C();if(s){const a=new File([s.buffer],s.name,{type:"application/pdf"});L([a])}},[]);const L=async s=>{const a=Array.from(s).filter(t=>t.type==="application/pdf").map(t=>({id:Math.random().toString(36).substr(2,9),file:t,pageCount:0,isLocked:!1,status:"pending"}));o(t=>[...t,...a]),P(!1),j();for(const t of a)ne(t.file).then(r=>{o(l=>l.map(i=>i.id===t.id?{...i,pageCount:r.pageCount,isLocked:r.isLocked,thumbnail:r.thumbnail}:i))})},O=async(s,a)=>{const t=n.find(l=>l.id===s);if(!t)return;const r=await ce(t.file,a);r.success?o(l=>l.map(i=>i.id===s?{...i,isLocked:!1,pageCount:r.pageCount,pdfDoc:r.pdfDoc,thumbnail:r.thumbnail,password:a}:i)):ee.error("Incorrect password")},Q=async(s,a)=>{let t=s.pdfDoc||await A(s.file);const r={high:1,medium:1.5,low:2},l={high:.3,medium:.5,low:.7},i=r[a],h=l[a],b=[];for(let m=1;m<=s.pageCount;m++){const D=await t.getPage(m),p=D.getViewport({scale:i}),c=document.createElement("canvas"),v=c.getContext("2d");if(!v)continue;c.height=p.height,c.width=p.width,await D.render({canvasContext:v,viewport:p}).promise;const K=c.toDataURL("image/jpeg",h).split(",")[1],U=window.atob(K),T=new Uint8Array(U.length);for(let B=0;B<U.length;B++)T[B]=U.charCodeAt(B);b.push({imageBytes:T,width:p.width,height:p.height}),c.width=0,c.height=0}return new Promise((m,D)=>{const p=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"});p.postMessage({type:"COMPRESS_PDF_ASSEMBLY",payload:{pages:b,quality:a}},b.map(c=>c.imageBytes.buffer)),p.onmessage=c=>{if(c.data.type==="SUCCESS"){const v=new Blob([c.data.payload],{type:"application/pdf"});m({url:S(v),size:v.size,buffer:c.data.payload}),p.terminate()}else D(new Error(c.data.payload)),p.terminate()}})},Z=async()=>{const s=n.filter(t=>!t.isLocked&&t.status==="pending");if(s.length===0)return;g(!0),N(0);const a=[];for(let t=0;t<s.length;t++){const r=s[t];o(l=>l.map(i=>i.id===r.id?{...i,status:"processing"}:i));try{const{url:l,size:i,buffer:h}=await Q(r,x);if(a.push({name:r.file.name.replace(".pdf","-compressed.pdf"),buffer:h}),o(b=>b.map(m=>m.id===r.id?{...m,status:"completed",resultUrl:l,resultSize:i}:m)),J({name:r.file.name.replace(".pdf","-compressed.pdf"),tool:"Compress",size:i,resultUrl:l}),s.length===1){const b=await s[0].file.arrayBuffer();z({buffer:h,name:r.file.name.replace(".pdf","-compressed.pdf"),originalBuffer:new Uint8Array(b)})}}catch{o(i=>i.map(h=>h.id===r.id?{...h,status:"error"}:h))}N(Math.round((t+1)/s.length*100))}if(a.length>1){const t=new $;a.forEach(l=>t.file(l.name,l.buffer));const r=await t.generateAsync({type:"blob"});S(r)}g(!1),P(!0)},X=async()=>{if(f&&n.length>1){const s=new $;for(const t of n)if(t.resultUrl){const r=await fetch(t.resultUrl);s.file(t.file.name.replace(".pdf","-compressed.pdf"),await r.arrayBuffer())}const a=await s.generateAsync({type:"blob"});await de(new Uint8Array(await a.arrayBuffer()),"paperknife-compressed.zip","application/zip")}},E=()=>e.jsx("button",{onClick:Z,disabled:k||n.filter(s=>!s.isLocked).length===0,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${F?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:k?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"animate-spin"})," ",u,"%"]}):e.jsxs(e.Fragment,{children:["Compress ",n.length," Files ",e.jsx(te,{size:18})]})});return e.jsxs(le,{title:"Compress PDF",description:"Reduce file size while maintaining quality. Everything stays on your device.",actions:n.length>0&&!R&&e.jsx(E,{}),children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",ref:w,onChange:s=>s.target.files&&L(s.target.files)}),n.length===0?e.jsxs("div",{onClick:()=>w.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(V,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDFs"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start batch compression"})]}):R?e.jsxs("div",{className:"space-y-6",children:[f&&n.length>1&&e.jsxs("button",{onClick:X,className:"block w-full bg-zinc-900 dark:bg-white text-white dark:text-black p-8 rounded-[2.5rem] text-center shadow-2xl transition-all group",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform",children:e.jsx(H,{className:"text-white",size:32})}),e.jsx("h3",{className:"text-2xl font-black tracking-tight mb-1",children:F?"Save All (ZIP)":"Download All (ZIP)"}),e.jsxs("p",{className:"text-xs font-bold opacity-60 uppercase tracking-widest",children:[n.length," Optimized Documents"]})]}),f&&n.length===1&&e.jsxs("div",{className:"space-y-8",children:[y?.originalBuffer&&y?.buffer&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border border-gray-100 dark:border-white/5 shadow-sm",children:e.jsx(me,{originalBuffer:y.originalBuffer,compressedBuffer:y.buffer})}),e.jsx(ue,{message:`Reduced by ${((1-(n[0].resultSize||0)/n[0].file.size)*100).toFixed(0)}%`,downloadUrl:f,fileName:n[0].file.name.replace(".pdf","-compressed.pdf"),onStartOver:()=>{o([]),P(!1),j()}})]}),e.jsx("button",{onClick:()=>{o([]),P(!1),j()},className:"w-full py-4 text-gray-400 hover:text-rose-500 font-black uppercase tracking-[0.2em] text-[10px]",children:"Start New Batch"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.map(s=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-2xl border border-gray-100 dark:border-white/5 flex items-center gap-4 relative group",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-black rounded-lg overflow-hidden shrink-0",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(W,{className:"text-gray-300",size:16})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-bold truncate dark:text-white",children:s.file.name}),s.isLocked?e.jsx("input",{type:"password",placeholder:"Unlock...",className:"bg-gray-50 dark:bg-black text-[8px] p-1 rounded outline-none w-20",onKeyDown:a=>{a.key==="Enter"&&O(s.id,a.currentTarget.value)}}):e.jsxs("p",{className:"text-[10px] text-gray-400 font-bold",children:[(s.file.size/(1024*1024)).toFixed(2)," MB â€¢ ",s.pageCount," p"]})]}),e.jsx("button",{onClick:()=>o(a=>a.filter(t=>t.id!==s.id)),className:"p-1 text-gray-300 hover:text-rose-500",children:e.jsx(G,{size:14})})]},s.id)),e.jsxs("button",{onClick:()=>w.current?.click(),className:"border-2 border-dashed border-gray-100 dark:border-zinc-800 rounded-2xl p-4 text-gray-400 flex flex-col items-center justify-center gap-1",children:[e.jsx(Y,{size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase",children:"Add More"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-4",children:"Compression Quality"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["high","medium","low"].map(s=>e.jsx("button",{onClick:()=>M(s),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-1 ${x===s?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-white/5"}`,children:e.jsx("span",{className:`font-black uppercase text-[10px] ${x===s?"text-rose-500":"text-gray-400"}`,children:s})},s))}),k&&!F&&e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all",style:{width:`${u}%`}})}),e.jsx("p",{className:"text-[10px] text-center font-black uppercase text-gray-400 tracking-widest animate-pulse",children:"Processing Batch..."})]}),!F&&e.jsx("div",{className:"mt-8",children:e.jsx(E,{})})]})]}),e.jsx(oe,{})]})}export{Ne as default};

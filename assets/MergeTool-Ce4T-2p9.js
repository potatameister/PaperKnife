import{j as e,u as ee,C as se,a as te}from"./index-D8gYrfEJ.js";import{u as re,A as ae,X as oe,Y as ne,r as g,E as k,P as R,_ as ie,U as le,$ as ce,a0 as de,a1 as xe,l as A,p as me,a2 as ue}from"./vendor-ui-B7y8O6hM.js";import{u as pe,a as B,D as ge,c as fe,S as he,v as be,b as ke,s as je,K as ve,P as we,d as ye,C as Ne}from"./vendor-utils-DxGvWCbh.js";import{T as Se,g as I,P as Ce,u as Fe}from"./ToolHeader-Dsv0oLd3.js";import{u as De}from"./useObjectURL-Cb4htcAy.js";import{S as Pe}from"./SuccessState-C5kS6smc.js";import"./tesseract-core-CZ-MX445.js";import"./pdfjs-viewer-BENO9Ct1.js";const ze="PaperKnifeWorkspace",Le=1,f="workspaces",E=()=>new Promise((a,o)=>{const c=indexedDB.open(ze,Le);c.onupgradeneeded=()=>{const i=c.result;i.objectStoreNames.contains(f)||i.createObjectStore(f,{keyPath:"toolId"})},c.onsuccess=()=>a(c.result),c.onerror=()=>o(c.error)}),Re=async(a,o)=>{try{const i=(await E()).transaction(f,"readwrite"),u=i.objectStore(f),p={toolId:a,files:o,lastUpdated:Date.now()};return u.put(p),new Promise((n,x)=>{i.oncomplete=()=>n(!0),i.onerror=()=>x(i.error)})}catch(c){console.error("Save Workspace Error:",c)}},T=async a=>{try{const u=(await E()).transaction(f,"readonly").objectStore(f).get(a);return new Promise((p,n)=>{u.onsuccess=()=>p(u.result||null),u.onerror=()=>n(u.error)})}catch(o){return console.error("Get Workspace Error:",o),null}},C=async a=>{try{(await E()).transaction(f,"readwrite").objectStore(f).delete(a)}catch(o){console.error("Clear Workspace Error:",o)}},Ee=({title:a,description:o,icon:c,children:i,actions:u,onBack:p})=>{const n=re();return e.jsxs("div",{className:"flex flex-col min-h-screen bg-[#FDFDFD] dark:bg-[#1C1B1F]",children:[e.jsxs("header",{className:"px-4 pt-safe pb-2 flex items-center justify-between sticky top-0 z-50 bg-white/80 dark:bg-[#1C1B1F]/80 backdrop-blur-md border-b border-gray-100 dark:border-white/5 md:hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx("button",{onClick:p||(()=>n(-1)),className:"p-2 rounded-full active:bg-gray-100 dark:active:bg-white/10 transition-colors",children:e.jsx(ae,{size:24,className:"dark:text-white"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h1",{className:"text-lg font-bold tracking-tight dark:text-white leading-none",children:a}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-rose-500 mt-1",children:"PaperKnife Node"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-2 rounded-full active:bg-gray-100 dark:active:bg-white/10 transition-colors",children:e.jsx(oe,{size:20,className:"text-gray-500 dark:text-gray-400"})}),e.jsx("button",{className:"p-2 rounded-full active:bg-gray-100 dark:active:bg-white/10 transition-colors",children:e.jsx(ne,{size:20,className:"text-gray-500 dark:text-gray-400"})})]})]}),e.jsxs("main",{className:"flex-1 flex flex-col p-4 md:p-8 max-w-5xl mx-auto w-full",children:[e.jsx("div",{className:"hidden md:block mb-8",children:e.jsx(Se,{title:a,description:o})}),e.jsx("div",{className:"md:hidden mb-6 mt-2",children:e.jsxs("div",{className:"flex items-center gap-4 p-6 bg-rose-500 rounded-[2rem] text-white shadow-lg shadow-rose-500/20",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-2xl",children:e.jsx(c,{size:32,strokeWidth:2.5})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-widest opacity-80",children:"Active Utility"}),e.jsx("h2",{className:"text-xl font-black tracking-tight",children:a})]})]})}),e.jsx("div",{className:"flex-1",children:i})]}),u&&e.jsx("div",{className:"md:hidden sticky bottom-0 left-0 right-0 p-4 bg-white/80 dark:bg-[#1C1B1F]/80 backdrop-blur-md border-t border-gray-100 dark:border-white/5 pb-safe",children:u})]})},Ue=a=>a<1024*1024?`${(a/1024).toFixed(1)} KB`:`${(a/(1024*1024)).toFixed(2)} MB`;function We({id:a,file:o,onRemove:c,onRotate:i,onUnlock:u}){const{attributes:p,listeners:n,setNodeRef:x,transform:j,transition:h,isDragging:b}=ye({id:a}),[v,F]=g.useState(""),[w,D]=g.useState(!1),y={transform:Ne.Transform.toString(j),transition:h,zIndex:b?50:0,position:"relative"},P=async()=>{D(!0),await u(a,v),D(!1)};return e.jsxs("div",{ref:x,style:y,className:`flex items-center gap-3 p-3 bg-white dark:bg-zinc-900 rounded-2xl border transition-all shadow-sm group touch-none relative ${b?"border-rose-300 dark:border-rose-800 shadow-xl scale-[1.02] ring-4 ring-rose-500/10":"border-gray-100 dark:border-zinc-800 hover:border-rose-200 dark:hover:border-rose-900/30"}`,children:[e.jsx("div",{...p,...n,className:"p-2 cursor-grab text-rose-400 hover:text-rose-600 dark:text-rose-500/50 dark:hover:text-rose-400 hover:bg-rose-500/10 rounded-lg transition-colors active:scale-90",children:e.jsx(xe,{size:20})}),e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-zinc-800 rounded-lg overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 relative group-hover:shadow-md transition-shadow",children:o.isLocked?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100 dark:bg-black text-rose-500",children:[e.jsx(A,{size:16}),e.jsx("span",{className:"text-[8px] font-black uppercase mt-1 text-center px-1",children:"Locked"})]}):o.thumbnail?e.jsx("img",{src:o.thumbnail,alt:"Preview",className:"w-full h-full object-cover transition-transform duration-500",style:{transform:`rotate(${o.rotation}deg)`}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center animate-pulse",children:e.jsx("div",{className:"w-4 h-4 border-2 border-rose-500 border-t-transparent rounded-full animate-spin"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold text-sm truncate text-gray-900 dark:text-white group-hover:text-rose-500 transition-colors",children:o.file.name}),o.isLocked&&e.jsx(A,{size:12,className:"text-rose-500 shrink-0"})]}),o.isLocked?e.jsxs("div",{className:"flex gap-1 mt-1",children:[e.jsx("input",{type:"password",placeholder:"Password",value:v,onChange:N=>F(N.target.value),className:"flex-1 bg-gray-50 dark:bg-black border border-gray-100 dark:border-zinc-800 rounded-lg px-2 py-1 text-[10px] font-bold outline-none focus:border-rose-500 text-gray-900 dark:text-white"}),e.jsx("button",{onClick:P,disabled:!v||w,className:"bg-rose-500 text-white px-2 py-1 rounded-lg text-[8px] font-black uppercase tracking-widest disabled:opacity-50 hover:scale-105 active:scale-95 transition-transform",children:w?"...":"Unlock"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 font-medium",children:[e.jsx("span",{children:Ue(o.file.size)}),o.pageCount>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[o.pageCount," pages"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>i(a),className:"p-2 hover:bg-gray-50 dark:hover:bg-zinc-800 rounded-full text-gray-400 hover:text-rose-500 transition-all hover:rotate-90 active:scale-90",title:"Rotate 90°",children:e.jsx(me,{size:18})}),e.jsx("button",{onClick:()=>c(a),className:"p-2 hover:bg-rose-500/10 rounded-full text-gray-400 hover:text-rose-500 transition-all hover:scale-110 active:scale-90",children:e.jsx(ue,{size:18})})]})]})}function Ke(){const a=g.useRef(null),{setPipelineFile:o,consumePipelineFile:c}=ee(),{objectUrl:i,createUrl:u,clearUrls:p}=De(),[n,x]=g.useState([]),[j,h]=g.useState(!1),[b,v]=g.useState("paperknife-merged"),[F,w]=g.useState(0),[D,y]=g.useState(!1),[P,N]=g.useState(!1),z=se.isNativePlatform(),$=pe(B(we),B(ve,{coordinateGetter:je}));g.useEffect(()=>{const s=c();if(s){const r=new File([s.buffer],s.name,{type:"application/pdf"});L([r]),k.success(`Imported ${r.name} from pipeline`)}},[]),g.useEffect(()=>{T("merge").then(s=>{s&&s.files.length>0&&n.length===0&&N(!0)})},[]),g.useEffect(()=>{n.length>0?(async()=>{const r=await Promise.all(n.map(async t=>({name:t.file.name,buffer:new Uint8Array(await t.file.arrayBuffer()),settings:{rotation:t.rotation,password:t.password}})));Re("merge",r)})():n.length===0&&!P&&C("merge")},[n]);const O=async()=>{const s=await T("merge");if(!s)return;const r=s.files.map(t=>({id:Math.random().toString(36).substr(2,9),file:new File([t.buffer],t.name,{type:"application/pdf"}),thumbnail:void 0,pageCount:0,isLocked:!1,rotation:t.settings.rotation||0,password:t.settings.password}));x(r),N(!1),k.success("Workspace restored successfully!");for(const t of r)I(t.file).then(l=>{x(m=>m.map(d=>d.id===t.id?{...d,thumbnail:l.thumbnail,pageCount:l.pageCount,isLocked:l.isLocked}:d))})},L=async s=>{const r=Array.from(s).filter(t=>t.type==="application/pdf").map(t=>({id:Math.random().toString(36).substr(2,9),file:t,thumbnail:void 0,pageCount:0,isLocked:!1,rotation:0}));if(r.length!==0){x(t=>[...t,...r]),p();for(const t of r)I(t.file).then(l=>{x(m=>m.map(d=>d.id===t.id?{...d,thumbnail:l.thumbnail,pageCount:l.pageCount,isLocked:l.isLocked}:d))})}},G=async(s,r)=>{const t=n.find(m=>m.id===s);if(!t)return;const l=await Fe(t.file,r);l.success?x(m=>m.map(d=>d.id===s?{...d,isLocked:!1,thumbnail:l.thumbnail,pageCount:l.pageCount,password:r}:d)):k.error("Incorrect password for "+t.file.name)},K=s=>{s.target.files&&L(s.target.files)},_=s=>{s.preventDefault(),y(!0)},V=s=>{s.preventDefault(),s.currentTarget&&!s.currentTarget.contains(s.relatedTarget)&&y(!1)},q=s=>{s.preventDefault(),y(!1),s.dataTransfer.files&&L(s.dataTransfer.files)},H=s=>{const{active:r,over:t}=s;r.id!==t?.id&&x(l=>{const m=l.findIndex(S=>S.id===r.id),d=l.findIndex(S=>S.id===t?.id);return ke(l,m,d)})},X=s=>{x(r=>r.filter(t=>t.id!==s)),p()},Y=s=>{x(r=>r.map(t=>t.id===s?{...t,rotation:(t.rotation+90)%360}:t)),p()},J=n.reduce((s,r)=>s+r.pageCount,0),Q=n.some(s=>s.isLocked),U=n.length>=2&&!Q,Z=async()=>{if(U){h(!0),w(0);try{const s=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"}),r=[];for(const t of n)r.push({buffer:await t.file.arrayBuffer(),rotation:t.rotation,password:t.password});s.postMessage({type:"MERGE_PDFS",payload:{files:r}}),s.onmessage=t=>{const{type:l,payload:m}=t.data;if(l==="PROGRESS")w(m);else if(l==="SUCCESS"){const d=new Blob([m],{type:"application/pdf"}),S=u(d),M=`${b||"merged"}.pdf`;o({buffer:m,name:M}),te({name:M,tool:"Merge",size:d.size,resultUrl:S}),h(!1),s.terminate(),C("merge"),k.success("PDFs merged successfully!")}else l==="ERROR"&&(k.error(m),h(!1),s.terminate())}}catch{k.error("An error occurred."),h(!1)}}},W=()=>e.jsx("button",{onClick:Z,disabled:j||!U,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${z?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"animate-spin"})," ",F,"%"]}):e.jsxs(e.Fragment,{children:["Merge PDFs ",e.jsx(de,{size:18})]})});return e.jsx(Ee,{title:"Merge PDF",description:"Combine multiple PDF files into one document. Processed entirely on your device.",icon:R,actions:n.length>0&&!i&&e.jsx(W,{}),children:e.jsxs("div",{onDragOver:_,onDragLeave:V,onDrop:q,className:"flex-1",children:[D&&e.jsxs("div",{className:"fixed inset-0 z-[100] bg-rose-500/90 backdrop-blur-xl flex flex-col items-center justify-center text-white p-6 animate-in fade-in duration-300",children:[e.jsx("div",{className:"w-32 h-32 bg-white/20 rounded-full flex items-center justify-center mb-8 animate-bounce",children:e.jsx(R,{size:64,strokeWidth:3})}),e.jsx("h2",{className:"text-4xl md:text-6xl font-black mb-4 text-center",children:"Drop to Add"})]}),P&&e.jsxs("div",{className:"mb-8 p-6 bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-100 dark:border-indigo-900/30 rounded-[2rem] flex flex-col md:flex-row items-center justify-between gap-4 animate-in slide-in-from-top duration-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white dark:bg-zinc-900 rounded-2xl flex items-center justify-center text-indigo-500 shadow-sm",children:e.jsx(ie,{size:24,className:"animate-spin-slow"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-black text-sm dark:text-white uppercase tracking-tight",children:"Unfinished Work Found"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-zinc-400 font-medium",children:"We saved your previous file list. Want to restore it?"})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsx("button",{onClick:O,className:"flex-1 md:flex-none px-6 py-3 bg-indigo-500 text-white rounded-xl text-xs font-black uppercase tracking-widest hover:bg-indigo-600 transition-colors shadow-lg shadow-indigo-500/20 active:scale-95",children:"Restore"}),e.jsx("button",{onClick:()=>{C("merge"),N(!1)},className:"flex-1 md:flex-none px-6 py-3 bg-white dark:bg-zinc-800 text-gray-400 hover:text-rose-500 rounded-xl text-xs font-black uppercase tracking-widest transition-colors active:scale-95",children:"Discard"})]})]}),e.jsxs("div",{className:"space-y-6",children:[n.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-gray-400",children:[n.length," Files • ",J," Pages"]}),e.jsx("button",{onClick:()=>{x([]),p(),C("merge")},className:"text-[10px] font-black uppercase text-rose-500/60 hover:text-rose-500 transition-colors",children:"Clear All"})]}),e.jsx(ge,{sensors:$,collisionDetection:fe,onDragEnd:H,children:e.jsx(he,{items:n.map(s=>s.id),strategy:be,children:n.map(s=>e.jsx(We,{id:s.id,file:s,onRemove:X,onRotate:Y,onUnlock:G},s.id))})}),e.jsxs("button",{onClick:()=>a.current?.click(),className:"w-full py-4 border-2 border-dashed border-gray-200 dark:border-zinc-800 rounded-2xl text-gray-400 font-bold text-sm flex items-center justify-center gap-2 hover:border-rose-500 hover:text-rose-500 transition-all",children:[e.jsx(R,{size:16})," Add More Files"]}),!i&&e.jsxs("div",{className:"p-6 bg-white dark:bg-zinc-900 rounded-3xl border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsx("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-2",children:"Filename"}),e.jsx("input",{type:"text",value:b,onChange:s=>v(s.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 outline-none font-bold text-sm border border-transparent focus:border-rose-500 transition-colors"})]})]}):e.jsxs("div",{onClick:()=>a.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(le,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF Files"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse or drag and drop here"})]}),n.length>0&&!i&&!z&&e.jsx("div",{className:"mt-8",children:e.jsx(W,{})}),j&&!z&&e.jsxs("div",{className:"mt-8 space-y-4",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all",style:{width:`${F}%`}})}),e.jsx("p",{className:"text-center text-[10px] font-black text-gray-400 uppercase tracking-widest animate-pulse",children:"Processing on Device..."})]}),i&&e.jsx("div",{className:"animate-in zoom-in duration-300",children:e.jsx(Pe,{message:"PDFs Merged Successfully!",downloadUrl:i,fileName:`${b||"merged"}.pdf`,onStartOver:()=>{x([]),p(),C("merge")}})})]}),e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",ref:a,onChange:K}),e.jsx(Ce,{})]})})}export{Ke as default};

import{u as R,C as M,j as e}from"./index-DVQ_-K-e.js";import{r as o,x as P,p as O,X as I,Z as U,ab as B,a5 as A,ac as Z,D as V,t as h,a2 as W,a3 as X}from"./vendor-ui-DVJtqS_b.js";import{T as q}from"./tesseract-core-8J3qwSEB.js";import{g as G,l as H,P as J,u as K,d as Q}from"./PrivacyBadge-BptljzUF.js";import{N as Y}from"./NativeToolLayout-Bywg2nrF.js";import"./pdfjs-viewer-BENO9Ct1.js";function oe(){const k=o.useRef(null),{consumePipelineFile:z}=R(),[a,x]=o.useState(null),[p,b]=o.useState(""),[n,c]=o.useState(!1),[w,m]=o.useState(0),[i,j]=o.useState("text"),[u,D]=o.useState(""),[S,y]=o.useState(!1),N=M.isNativePlatform();o.useEffect(()=>{const t=z();if(t){const s=new File([t.buffer],t.name,{type:"application/pdf"});v(s)}},[]);const T=async()=>{if(!a||!u)return;c(!0);const t=await K(a.file,u);t.success?x({...a,isLocked:!1,pageCount:t.pageCount,pdfDoc:t.pdfDoc,password:u}):h.error("Incorrect password"),c(!1)},v=async t=>{if(t.type==="application/pdf"){c(!0);try{const s=await G(t);if(s.isLocked)x({file:t,pageCount:0,isLocked:!0});else{const g=await H(t);x({file:t,pageCount:s.pageCount,isLocked:!1,pdfDoc:g})}b("")}catch(s){console.error(s)}finally{c(!1)}}},F=async()=>{if(!(!a||!a.pdfDoc)){c(!0),m(0),b("");try{let t="";if(i==="text")for(let s=1;s<=a.pageCount;s++){const r=await(await a.pdfDoc.getPage(s)).getTextContent();t+=`--- Page ${s} ---
${r.items.map(l=>l.str).join(" ")}

`,m(Math.round(s/a.pageCount*100))}else{const s=await q.createWorker("eng",1,{logger:r=>{if(r.status==="recognizing text"){const l=(g-1)/a.pageCount*100;m(Math.round(l+r.progress*(100/a.pageCount)))}}});let g=1;for(let r=1;r<=a.pageCount;r++){g=r;const l=await a.pdfDoc.getPage(r),f=l.getViewport({scale:2}),d=document.createElement("canvas"),C=d.getContext("2d");if(!C)continue;d.height=f.height,d.width=f.width,await l.render({canvasContext:C,viewport:f}).promise;const{data:{text:$}}=await s.recognize(d);t+=`--- Page ${r} (OCR) ---
${$}

`,d.width=0,d.height=0}await s.terminate()}b(t),h.success("Complete!")}catch(t){h.error(t.message)}finally{c(!1)}}},E=async()=>{await Q(p,`${a?.file.name.replace(".pdf","")}-extracted.txt`,"text/plain")},L=()=>e.jsx("button",{onClick:F,disabled:n,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${N?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"animate-spin"})," ",w,"%"]}):e.jsxs(e.Fragment,{children:["Extract Text ",e.jsx(X,{size:18})]})});return e.jsxs(Y,{title:"PDF to Text",description:"Extract text using fast scan or deep local OCR.",actions:a&&!a.isLocked&&!p&&e.jsx(L,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:k,onChange:t=>t.target.files?.[0]&&v(t.target.files[0])}),a?a.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(O,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:u,onChange:t=>D(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:T,disabled:!u||n,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:e.jsx(P,{size:24})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:a.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:[a.pageCount," Pages â€¢ ",(a.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>x(null),className:"p-2 text-gray-400 hover:text-rose-500",children:e.jsx(I,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-8 shadow-sm",children:p?e.jsxs("div",{className:"space-y-6",children:[e.jsx("textarea",{readOnly:!0,value:p,className:"w-full h-80 bg-gray-50 dark:bg-black border border-gray-100 dark:border-white/5 rounded-2xl p-4 font-mono text-[10px] resize-none outline-none focus:border-rose-500 dark:text-gray-300 shadow-inner"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(p),y(!0),setTimeout(()=>y(!1),2e3)},className:"flex-1 bg-white dark:bg-zinc-800 text-gray-900 dark:text-white border border-gray-100 dark:border-white/5 p-4 rounded-2xl font-black flex items-center justify-center gap-2 transition-all active:scale-95",children:[S?e.jsx(A,{size:18,className:"text-emerald-500"}):e.jsx(Z,{size:18})," Copy"]}),e.jsxs("button",{onClick:E,className:"flex-[2] bg-gray-900 dark:bg-white text-white dark:text-black p-4 rounded-2xl font-black flex items-center justify-center gap-2 shadow-xl active:scale-95 transition-all",children:[e.jsx(V,{size:18})," ",N?"Save .txt":"Download"]})]}),e.jsx("button",{onClick:()=>{b(""),m(0),x(null)},className:"w-full py-2 text-gray-400 uppercase font-black text-[10px] hover:text-rose-500 transition-colors",children:"Close File"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>j("text"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center ${i==="text"?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-white/5"}`,children:[e.jsx(U,{size:20,className:i==="text"?"text-rose-500":"text-gray-400"}),e.jsx("span",{className:"font-black uppercase text-[10px] mt-1",children:"Fast Scan"})]}),e.jsxs("button",{onClick:()=>j("ocr"),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center ${i==="ocr"?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-white/5"}`,children:[e.jsx(B,{size:20,className:i==="ocr"?"text-rose-500":"text-gray-400"}),e.jsx("span",{className:"font-black uppercase text-[10px] mt-1",children:"Deep OCR"})]})]}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all",style:{width:`${w}%`}})}),e.jsx("p",{className:"text-center text-[10px] font-black text-gray-400 uppercase tracking-widest animate-pulse px-1",children:"Scanning Document..."})]}),!n&&e.jsxs("div",{className:"space-y-4",children:[i==="ocr"&&e.jsx("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/10 rounded-xl border border-amber-100 dark:border-amber-900/20",children:e.jsx("p",{className:"text-[10px] text-amber-700 dark:text-amber-400 font-bold uppercase tracking-widest text-center",children:"Note: Deep OCR is CPU-intensive and may take a few minutes depending on your device performance."})}),e.jsx("div",{className:"p-4 bg-rose-50 dark:bg-rose-900/10 rounded-xl border border-rose-100 dark:border-rose-900/20 text-center",children:e.jsx("p",{className:"text-[10px] text-rose-600 dark:text-rose-400 font-bold uppercase tracking-widest",children:"Select mode and tap Extract"})})]})]})})]}):e.jsxs("div",{onClick:()=>!n&&k.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(P,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse files"})]}),e.jsx(J,{})]})}export{oe as default};

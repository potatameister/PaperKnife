import{j as e,a as D}from"./index-D8gYrfEJ.js";import{r as n,$ as L,k as S,l as R,a3 as W,P as _,a4 as H,E as z}from"./vendor-ui-B7y8O6hM.js";import{J}from"./vendor-utils-DxGvWCbh.js";import{T as Z,P as q,u as K,r as V,g as G,l as Q}from"./ToolHeader-Dsv0oLd3.js";import{u as X}from"./useObjectURL-Cb4htcAy.js";import{S as Y}from"./SuccessState-C5kS6smc.js";import"./tesseract-core-CZ-MX445.js";import"./pdfjs-viewer-BENO9Ct1.js";const ee=({pdfDoc:m,pageNum:g})=>{const[p,i]=n.useState(null),r=n.useRef(null);return n.useEffect(()=>{if(!m||p)return;const c=new IntersectionObserver(w=>{w[0].isIntersecting&&(V(m,g,1).then(i),c.disconnect())},{rootMargin:"200px"});return r.current&&c.observe(r.current),()=>c.disconnect()},[m,g,p]),p?e.jsx("img",{src:p,className:"w-full h-full object-cover animate-in fade-in duration-300",alt:`Page ${g}`}):e.jsx("div",{ref:r,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center text-xs font-bold text-gray-400",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function ce(){const m=n.useRef(null),{objectUrl:g,createUrl:p,clearUrls:i}=X(),[r,c]=n.useState(null),[w,f]=n.useState(!1),[h,v]=n.useState(!1),[u,b]=n.useState(new Set),[y,U]=n.useState("paperknife-split"),[C,N]=n.useState(""),[k,P]=n.useState("single"),[j,$]=n.useState(""),E=async()=>{if(!r||!j)return;v(!0);const s=await K(r.file,j);if(s.success){c({...r,isLocked:!1,pageCount:s.pageCount,pdfDoc:s.pdfDoc,password:j});const t=new Set;for(let l=1;l<=s.pageCount;l++)t.add(l);b(t),N(`1-${s.pageCount}`)}else z.error("Incorrect password");v(!1)},T=async s=>{if(s.type==="application/pdf"){v(!0);try{const t=await G(s);if(console.log("File metadata:",t),t.isLocked)c({file:s,pageCount:0,isLocked:!0});else{const l=await Q(s);c({file:s,pageCount:t.pageCount,isLocked:!1,pdfDoc:l});const a=new Set;for(let o=1;o<=t.pageCount;o++)a.add(o);b(a),N(`1-${t.pageCount}`)}}catch(t){console.error(t)}finally{v(!1),i()}}},I=s=>{s.target.files?.[0]&&T(s.target.files[0])},M=s=>{const t=new Set(u);t.has(s)?t.delete(s):t.add(s),b(t),i()},A=s=>{if(!r)return;const t=new Set;s.split(",").map(a=>a.trim()).forEach(a=>{if(a.includes("-")){const[o,d]=a.split("-").map(Number);if(!isNaN(o)&&!isNaN(d))for(let x=Math.max(1,o);x<=Math.min(d,r.pageCount);x++)t.add(x)}else{const o=Number(a);!isNaN(o)&&o>=1&&o<=r.pageCount&&t.add(o)}}),b(t),i()},B=async()=>{if(!(!r||u.size===0)){f(!0);try{const s=await r.file.arrayBuffer(),t=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"});t.postMessage({type:"SPLIT_PDF",payload:{buffer:s,password:r.password,selectedPages:Array.from(u),mode:k,customFileName:y}}),t.onmessage=async l=>{const{type:a,payload:o}=l.data;if(a==="SUCCESS"){const d=new Blob([o],{type:"application/pdf"}),x=p(d);D({name:`${y||"split"}.pdf`,tool:"Split",size:d.size,resultUrl:x}),f(!1),t.terminate()}else if(a==="SUCCESS_BATCH"){const d=new J;o.forEach(F=>{d.file(F.name,F.buffer)});const x=await d.generateAsync({type:"blob"}),O=p(x);D({name:`${y||"split"}.zip`,tool:"Split",size:x.size,resultUrl:O}),f(!1),t.terminate()}else a==="ERROR"&&(z.error(o),f(!1),t.terminate())}}catch(s){z.error(s.message||"Error splitting PDF."),f(!1)}}};return e.jsx("div",{className:"flex-1",children:e.jsxs("main",{className:"max-w-6xl mx-auto px-6 py-6 md:py-10",children:[e.jsx(Z,{title:"Visual",highlight:"Splitter",description:"Select pages visually or by range to extract them. Everything stays on your device."}),e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:m,onChange:I}),r?r.isLocked?e.jsx("div",{className:"max-w-md mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-zinc-800 shadow-xl text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(R,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"File is Protected"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-zinc-400 mb-8",children:"This PDF requires a password to open."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"password",value:j,onChange:s=>$(s.target.value),placeholder:"Enter Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-gray-100 dark:border-zinc-800 focus:border-rose-500 outline-none font-bold text-center transition-all",autoFocus:!0}),e.jsx("button",{onClick:E,disabled:!j||h,className:"w-full bg-rose-500 hover:bg-rose-600 text-white p-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all active:scale-95 disabled:opacity-50",children:h?"Unlocking...":"Unlock PDF"}),e.jsx("button",{onClick:()=>c(null),className:"w-full py-2 text-xs font-bold text-gray-400 hover:text-rose-500",children:"Choose different file"})]})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-zinc-800 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-xs text-gray-400",children:"Click to select pages"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const s=new Set;for(let t=1;t<=r.pageCount;t++)s.add(t);b(s)},className:"text-[10px] font-black uppercase text-rose-500 hover:underline",children:"Select All"}),e.jsx("button",{onClick:()=>b(new Set),className:"text-[10px] font-black uppercase text-gray-400 hover:underline",children:"Deselect All"})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-2 scrollbar-hide",children:Array.from({length:r.pageCount}).map((s,t)=>{const l=t+1,a=u.has(l);return e.jsxs("div",{onClick:()=>M(l),className:`relative group cursor-pointer aspect-[3/4] rounded-xl overflow-hidden border-2 transition-all ${a?"border-rose-500 shadow-lg scale-[1.02]":"border-transparent hover:border-gray-200 dark:hover:border-zinc-700"}`,children:[e.jsx(ee,{pdfDoc:r.pdfDoc,pageNum:l}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center transition-opacity ${a?"bg-rose-500/10 opacity-100":"bg-black/20 opacity-0 group-hover:opacity-100"}`,children:e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shadow-lg transition-transform ${a?"bg-rose-500 text-white scale-100":"bg-white text-gray-400 scale-75"}`,children:a?e.jsx(W,{size:20,strokeWidth:3}):e.jsx(_,{size:20})})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[10px] font-bold text-white uppercase tracking-tighter",children:["P. ",l]})]},l)})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-zinc-800 shadow-sm sticky top-24",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-1 dark:text-white truncate",children:r.file.name}),e.jsxs("p",{className:"text-xs text-gray-400 uppercase font-black tracking-widest",children:[r.pageCount," Pages â€¢ ",(r.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(S,{size:12})," Split Mode"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 bg-gray-50 dark:bg-black p-1 rounded-2xl border border-gray-100 dark:border-zinc-800",children:[e.jsx("button",{onClick:()=>{P("single"),i()},className:`py-2 px-3 rounded-xl text-[10px] font-black uppercase transition-all ${k==="single"?"bg-white dark:bg-zinc-800 text-rose-500 shadow-sm":"text-gray-400"}`,children:"Single File"}),e.jsx("button",{onClick:()=>{P("individual"),i()},className:`py-2 px-3 rounded-xl text-[10px] font-black uppercase transition-all ${k==="individual"?"bg-white dark:bg-zinc-800 text-rose-500 shadow-sm":"text-gray-400"}`,children:"Individual (ZIP)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(H,{size:12})," Custom Filename"]}),e.jsx("input",{type:"text",value:y,onChange:s=>U(s.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-gray-100 dark:border-zinc-800 text-sm font-bold outline-none focus:border-rose-500"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[10px] font-black uppercase tracking-widest text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(S,{size:12})," Range Selector"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:s=>N(s.target.value),placeholder:"e.g. 1, 3-5",className:"flex-1 bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-gray-100 dark:border-zinc-800 text-sm font-bold outline-none focus:border-rose-500"}),e.jsx("button",{onClick:()=>A(C),className:"px-4 bg-gray-100 dark:bg-zinc-800 rounded-xl font-bold text-xs hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors",children:"Apply"})]})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-zinc-800",children:[e.jsxs("div",{className:"flex justify-between items-end mb-4 px-1",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest",children:"Selection"}),e.jsxs("span",{className:"text-xl font-black text-rose-500",children:[u.size," ",e.jsx("span",{className:"text-xs text-gray-400",children:"Pages"})]})]}),g?e.jsx("div",{className:"space-y-3",children:e.jsx(Y,{message:"Ready for Download",downloadUrl:g||"",fileName:`${y||"split"}.${k==="single"?"pdf":"zip"}`,onStartOver:()=>i(),showPreview:k==="single"})}):e.jsx("button",{onClick:B,disabled:w||u.size===0,className:"w-full bg-rose-500 hover:bg-rose-600 text-white p-4 rounded-2xl shadow-xl shadow-rose-200 dark:shadow-none font-black tracking-tight transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3",children:w?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"animate-spin"})," Splitting..."]}):"Extract Selection"})]}),e.jsx("button",{onClick:()=>{c(null),i()},className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors tracking-[0.2em]",children:"Close File"})]}),r.password&&e.jsxs("div",{className:"mt-6 p-4 bg-amber-50 dark:bg-amber-900/10 rounded-2xl border border-amber-100 dark:border-amber-900/20 flex items-start gap-3",children:[e.jsx(R,{size:14,className:"text-amber-500 shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-[10px] text-amber-700 dark:text-amber-400 leading-relaxed font-medium",children:[e.jsx("strong",{children:"Security Note:"})," This file was protected. The extracted pages will be saved ",e.jsx("strong",{children:"without"})," a password."]})]})]})})]}):e.jsx("div",{onClick:()=>!h&&m.current?.click(),className:`border-4 border-dashed border-gray-200 dark:border-zinc-800 rounded-[2rem] md:rounded-[2.5rem] bg-white/50 dark:bg-zinc-900/50 p-10 md:p-20 text-center hover:border-rose-300 dark:hover:border-rose-900 hover:bg-rose-50/50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group ${h?"opacity-50 cursor-wait":""}`,children:h?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(L,{size:48,className:"text-rose-500 animate-spin mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Analyzing PDF..."}),e.jsxs("p",{className:"text-xs text-gray-400 max-w-xs mx-auto leading-relaxed",children:["Processing is 100% local on your device. ",e.jsx("br",{}),"Large files may take a moment depending on your hardware."]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-16 h-16 md:w-24 md:h-24 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6 group-hover:scale-110 transition-transform",children:e.jsx(S,{size:32})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold mb-1 md:mb-2 group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors",children:"Select PDF"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-400 dark:text-zinc-500",children:"Tap to start splitting"})]})}),e.jsx(q,{})]})})}export{ce as default};

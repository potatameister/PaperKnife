import{C as $,j as e,a as E}from"./index-CwQWfSva.js";import{r as l,m as k,l as A,a0 as M,G as L,Y as O,_ as J}from"./vendor-ui-Bs56Vaqo.js";import{P as V}from"./pdf-lib-core-BGakJ5qG.js";import{P as X,u as Y,g as _,l as q}from"./PrivacyBadge-DtnXHkrx.js";import{S as H}from"./SuccessState-D432dsD-.js";import{N as K}from"./NativeToolLayout-CBoOIgYn.js";import"./pdfjs-viewer-BENO9Ct1.js";function oe(){const v=l.useRef(null),[a,u]=l.useState(null),[m,c]=l.useState(!1),[S,g]=l.useState(0),[h,f]=l.useState(null),[b,w]=l.useState("paperknife-grayscale"),[d,U]=l.useState(""),N=$.isNativePlatform(),R=async()=>{if(!a||!d)return;c(!0);const t=await Y(a.file,d);t.success?(u({...a,isLocked:!1,pageCount:t.pageCount,pdfDoc:t.pdfDoc,thumbnail:t.thumbnail,password:d}),w(`${a.file.name.replace(".pdf","")}-grayscale`)):L.error("Incorrect password"),c(!1)},G=async t=>{if(t.type==="application/pdf"){c(!0);try{const r=await _(t);if(r.isLocked)u({file:t,pageCount:0,isLocked:!0});else{const j=await q(t);u({file:t,pageCount:r.pageCount,isLocked:!1,pdfDoc:j,thumbnail:r.thumbnail}),w(`${t.name.replace(".pdf","")}-grayscale`)}}catch(r){console.error(r)}finally{c(!1),f(null)}}},B=async()=>{if(!(!a||!a.pdfDoc)){c(!0),g(0),await new Promise(t=>setTimeout(t,100));try{const t=await V.create(),r=1.5;for(let x=1;x<=a.pageCount;x++){const z=await a.pdfDoc.getPage(x),o=z.getViewport({scale:r}),i=document.createElement("canvas"),p=i.getContext("2d",{alpha:!1});if(!p)continue;i.height=o.height,i.width=o.width,await z.render({canvasContext:p,viewport:o}).promise;const F=p.getImageData(0,0,i.width,i.height),n=F.data;for(let s=0;s<n.length;s+=4){const y=n[s]*.299+n[s+1]*.587+n[s+2]*.114;n[s]=y,n[s+1]=y,n[s+2]=y}p.putImageData(F,0,0);const I=i.toDataURL("image/jpeg",.75),T=await t.embedJpg(I);t.addPage([o.width,o.height]).drawImage(T,{x:0,y:0,width:o.width,height:o.height}),g(Math.round(x/a.pageCount*100))}const j=await t.save(),C=new Blob([j],{type:"application/pdf"}),D=URL.createObjectURL(C);f(D),E({name:`${b}.pdf`,tool:"Grayscale",size:C.size,resultUrl:D})}catch(t){L.error(`Error: ${t.message}`)}finally{c(!1)}}},P=()=>e.jsx("button",{onClick:B,disabled:m,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${N?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"animate-spin"})," ",S,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:18})," Convert to Grayscale ",e.jsx(J,{size:18})]})});return e.jsxs(K,{title:"PDF to Grayscale",description:"Remove colors from your PDF to save ink and storage.",actions:a&&!a.isLocked&&!h&&e.jsx(P,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:v,onChange:t=>t.target.files?.[0]&&G(t.target.files[0])}),a?a.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(A,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:d,onChange:t=>U(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:R,disabled:!d||m,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:a.thumbnail?e.jsx("img",{src:a.thumbnail,className:"w-full h-full object-cover"}):e.jsx(k,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:a.file.name}),e.jsxs("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:[a.pageCount," Pages â€¢ ",(a.file.size/(1024*1024)).toFixed(1)," MB"]})]}),e.jsx("button",{onClick:()=>u(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(M,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 space-y-8",children:h?e.jsx(H,{message:"Grayscale Conversion Complete!",downloadUrl:h,fileName:`${b}.pdf`,onStartOver:()=>{f(null),g(0)}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center py-4",children:e.jsxs("p",{className:"text-sm text-gray-500 dark:text-zinc-400 leading-relaxed font-medium",children:["This tool converts all document pages to black-and-white.",e.jsx("br",{}),"Best for printing and reducing file size."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Output Filename"}),e.jsx("input",{type:"text",value:b,onChange:t=>w(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),!N&&e.jsx(P,{})]})})]}):e.jsxs("div",{onClick:()=>!m&&v.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(k,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start desaturating"})]}),e.jsx(X,{})]})}export{oe as default};

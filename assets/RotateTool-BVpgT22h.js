import{C as $,j as e,a as A}from"./index-d1EuGhki.js";import{r as o,p as h,l as E,a6 as B,E as P,X as I,Y as O}from"./vendor-ui-BR-XW_se.js";import{P as M,d as W}from"./pdf-lib-core-B0uti0Qf.js";import{N as X,P as Y,u as _,g as q,l as G,r as H}from"./NativeToolLayout-CjQEpJHn.js";import{S as J}from"./SuccessState-D_MeTVd1.js";import"./pdfjs-viewer-BENO9Ct1.js";const K=({pdfDoc:i,pageNum:s,rotation:d})=>{const[n,u]=o.useState(null),l=o.useRef(null);return o.useEffect(()=>{if(!i||n)return;const a=new IntersectionObserver(p=>{p[0].isIntersecting&&(H(i,s,1).then(u),a.disconnect())},{rootMargin:"200px"});return l.current&&a.observe(l.current),()=>a.disconnect()},[i,s,n]),n?e.jsx("img",{src:n,className:"w-full h-full object-contain transition-transform duration-300 bg-white",style:{transform:`rotate(${d}deg)`},alt:`P${s}`}):e.jsx("div",{ref:l,className:"w-full h-full bg-gray-100 dark:bg-zinc-800 flex items-center justify-center",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-transparent rounded-full animate-spin"})})};function re(){const i=o.useRef(null),[s,d]=o.useState(null),[n,u]=o.useState({}),[l,a]=o.useState(!1),[p,x]=o.useState(null),[m,g]=o.useState("paperknife-rotated"),[f,C]=o.useState(""),j=$.isNativePlatform(),R=async()=>{if(!s||!f)return;a(!0);const t=await _(s.file,f);t.success?(d({...s,isLocked:!1,pageCount:t.pageCount,pdfDoc:t.pdfDoc,password:f}),g(`${s.file.name.replace(".pdf","")}-rotated`)):P.error("Incorrect password"),a(!1)},D=async t=>{if(t.type==="application/pdf"){a(!0);try{const r=await q(t);if(r.isLocked)d({file:t,pageCount:0,isLocked:!0});else{const c=await G(t);d({file:t,pageCount:r.pageCount,isLocked:!1,pdfDoc:c}),g(`${t.name.replace(".pdf","")}-rotated`),u({})}}catch(r){console.error(r)}finally{a(!1),x(null)}}},F=t=>{u(r=>({...r,[t]:((r[t]||0)+90)%360})),x(null)},z=()=>{const t={...n};for(let r=1;r<=(s?.pageCount||0);r++)t[r]=((t[r]||0)+90)%360;u(t),x(null)},S=async()=>{if(s){a(!0),await new Promise(t=>setTimeout(t,100));try{const t=await s.file.arrayBuffer(),r=await M.load(t,{password:s.password||void 0,ignoreEncryption:!0});r.getPages().forEach((v,L)=>{const T=L+1,N=n[T]||0;if(N!==0){const U=v.getRotation().angle;v.setRotation(W((U+N)%360))}});const b=await r.save(),y=new Blob([b],{type:"application/pdf"}),k=URL.createObjectURL(y);x(k),A({name:`${m}.pdf`,tool:"Rotate",size:y.size,resultUrl:k})}catch(t){P.error(`Error: ${t.message}`)}finally{a(!1)}}},w=()=>e.jsx("button",{onClick:S,disabled:l,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${j?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:l?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"animate-spin"})," Working..."]}):e.jsxs(e.Fragment,{children:["Save Rotated PDF ",e.jsx(O,{size:18})]})});return e.jsxs(X,{title:"Rotate PDF",description:"Fix page orientation permanently. Processed locally.",actions:s&&!s.isLocked&&!p&&e.jsx(w,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:i,onChange:t=>t.target.files?.[0]&&D(t.target.files[0])}),s?s.isLocked?e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2.5rem] border border-gray-100 dark:border-white/5 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-100 dark:bg-rose-900/30 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(E,{size:32})}),e.jsx("h3",{className:"text-2xl font-bold mb-2 dark:text-white",children:"Protected File"}),e.jsx("input",{type:"password",value:f,onChange:t=>C(t.target.value),placeholder:"Password",className:"w-full bg-gray-50 dark:bg-black rounded-2xl px-6 py-4 border border-transparent focus:border-rose-500 outline-none font-bold text-center mb-4"}),e.jsx("button",{onClick:R,disabled:!f||l,className:"w-full bg-rose-500 text-white p-4 rounded-2xl font-black uppercase text-xs",children:"Unlock"})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in fade-in duration-500",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"font-black uppercase tracking-widest text-[10px] text-gray-400",children:"Tap pages to rotate"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:z,className:"text-[10px] font-black uppercase text-rose-500 flex items-center gap-1",children:[e.jsx(h,{size:12})," All"]}),e.jsxs("button",{onClick:()=>u({}),className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-1",children:[e.jsx(B,{size:12})," Reset"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-[60vh] overflow-y-auto p-1 scrollbar-hide",children:Array.from({length:s.pageCount}).map((t,r)=>{const c=r+1,b=n[c]||0;return e.jsxs("div",{onClick:()=>F(c),className:"relative group cursor-pointer aspect-[3/4] rounded-xl overflow-hidden border-2 border-transparent hover:border-rose-500 transition-all bg-gray-50 dark:bg-black",children:[e.jsx("div",{className:"w-full h-full p-2",children:e.jsx(K,{pdfDoc:s.pdfDoc,pageNum:c,rotation:b})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/0 group-hover:bg-black/10 transition-colors",children:e.jsx("div",{className:"bg-white text-rose-500 p-2 rounded-full opacity-0 group-hover:opacity-100 shadow-lg scale-75 group-hover:scale-100 transition-all",children:e.jsx(h,{size:20})})}),e.jsxs("div",{className:"absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-md rounded text-[10px] font-bold text-white",children:["P. ",c]})]},c)})})]})}),e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm sticky top-24",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-3",children:"Filename"}),e.jsx("input",{type:"text",value:m,onChange:t=>g(t.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),p?e.jsx(J,{message:"PDF Rotated!",downloadUrl:p,fileName:`${m}.pdf`,onStartOver:()=>x(null)}):!j&&e.jsx(w,{}),e.jsx("button",{onClick:()=>d(null),className:"w-full py-2 text-[10px] font-black uppercase text-gray-300 hover:text-rose-500 transition-colors",children:"Close File"})]})})})]}):e.jsxs("div",{onClick:()=>!l&&i.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(h,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to start rotating"})]}),e.jsx(Y,{})]})}export{re as default};

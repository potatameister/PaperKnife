import{u as K,C as _,j as e,a as V}from"./index-DVQ_-K-e.js";import{r as m,t as T,Z as $,F as Y,X as H,P as ee,D as te,a7 as se,a2 as ae,a3 as re,a8 as ie,a9 as ne,h as oe}from"./vendor-ui-DVJtqS_b.js";import{J as I}from"./vendor-utils-BuRRKp-C.js";import{g as le,P as ce,u as de,d as pe,l as M,r as O}from"./PrivacyBadge-BptljzUF.js";import{u as me}from"./useObjectURL-BPDTmczq.js";import{S as he}from"./SuccessState-R0HWCMze.js";import{N as ue}from"./NativeToolLayout-Bywg2nrF.js";import"./tesseract-core-8J3qwSEB.js";import"./pdfjs-viewer-BENO9Ct1.js";const fe=({originalBuffer:w,compressedBuffer:S})=>{const[C,y]=m.useState(""),[g,P]=m.useState(""),[j,n]=m.useState(50),d=m.useRef(null);m.useEffect(()=>{(async()=>{try{const f=await M(new File([w],"orig.pdf",{type:"application/pdf"})),v=await M(new File([S],"comp.pdf",{type:"application/pdf"})),h=await O(f,1,2),E=await O(v,1,2);y(h),P(E)}catch(f){console.error(f)}})()},[w,S]);const k=x=>{if(!d.current)return;const f=d.current.getBoundingClientRect(),h=(("touches"in x?x.touches[0].clientX:x.clientX)-f.left)/f.width*100;n(Math.max(0,Math.min(100,h)))};return!C||!g?e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center bg-gray-50 dark:bg-zinc-900 rounded-[2rem] animate-pulse",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-rose-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-[10px] font-black uppercase text-gray-400",children:"Comparing Quality..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center px-2",children:e.jsxs("h4",{className:"text-[10px] font-black uppercase text-gray-400 flex items-center gap-2",children:[e.jsx(ie,{size:12})," Quality Inspection"]})}),e.jsxs("div",{ref:d,className:"relative h-80 md:h-[400px] rounded-[2rem] overflow-hidden cursor-ew-resize select-none border border-gray-100 dark:border-white/5",onMouseMove:k,onTouchMove:k,children:[e.jsx("img",{src:g,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Compressed"}),e.jsx("div",{className:"absolute inset-0 w-full h-full overflow-hidden",style:{clipPath:`inset(0 ${100-j}% 0 0)`},children:e.jsx("img",{src:C,className:"absolute inset-0 w-full h-full object-contain bg-white",alt:"Original"})}),e.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white shadow-xl z-10",style:{left:`${j}%`},children:e.jsxs("div",{className:"absolute top-1/2 -translate-y-1/2 -translate-x-1/2 w-8 h-8 bg-white dark:bg-zinc-900 rounded-full shadow-2xl border border-gray-100 dark:border-white/5 flex items-center justify-center text-rose-500",children:[e.jsx(ne,{size:14}),e.jsx(oe,{size:14})]})})]})]})};function Se(){const w=m.useRef(null),{consumePipelineFile:S,setPipelineFile:C,lastPipelinedFile:y}=K(),{objectUrl:g,createUrl:P,clearUrls:j}=me(),[n,d]=m.useState([]),[k,x]=m.useState(!1),[f,v]=m.useState(0),[h,E]=m.useState("medium"),[A,F]=m.useState(!1),Q=_.isNativePlatform();m.useEffect(()=>{const t=S();if(t){if(t.type&&t.type!=="application/pdf"){T.error("The file from the previous tool is not a PDF and cannot be used here.");return}const r=new File([t.buffer],t.name,{type:"application/pdf"});U([r])}},[]);const U=async t=>{const r=Array.from(t).filter(s=>s.type==="application/pdf").map(s=>({id:Math.random().toString(36).substr(2,9),file:s,pageCount:0,isLocked:!1,status:"pending"}));d(s=>[...s,...r]),F(!1),j();for(const s of r)le(s.file).then(a=>{d(o=>o.map(i=>i.id===s.id?{...i,pageCount:a.pageCount,isLocked:a.isLocked,thumbnail:a.thumbnail}:i))})},Z=async(t,r)=>{const s=n.find(o=>o.id===t);if(!s)return;const a=await de(s.file,r);a.success?d(o=>o.map(i=>i.id===t?{...i,isLocked:!1,pageCount:a.pageCount,pdfDoc:a.pdfDoc,thumbnail:a.thumbnail,password:r}:i)):T.error("Incorrect password")},q=async(t,r,s)=>{let a=t.pdfDoc||await M(t.file);const o={high:1,medium:1.5,low:2},i={high:.3,medium:.5,low:.7},p=o[r],D=i[r],b=[];for(let u=1;u<=t.pageCount;u++){const N=await a.getPage(u),c=N.getViewport({scale:p}),l=document.createElement("canvas"),z=l.getContext("2d");if(!z)continue;l.height=c.height,l.width=c.width,await N.render({canvasContext:z,viewport:c}).promise;const X=l.toDataURL("image/jpeg",D).split(",")[1],R=window.atob(X),L=new Uint8Array(R.length);for(let B=0;B<R.length;B++)L[B]=R.charCodeAt(B);b.push({imageBytes:L,width:c.width,height:c.height}),s&&s(Math.round(u/t.pageCount*50)),l.width=0,l.height=0}return new Promise((u,N)=>{try{const c=new Worker(new URL("/PaperKnife/assets/pdfWorker-DTSgDFeA.js",import.meta.url),{type:"module"});c.postMessage({type:"COMPRESS_PDF_ASSEMBLY",payload:{pages:b,quality:r}},b.map(l=>l.imageBytes.buffer)),c.onmessage=l=>{if(l.data.type==="PROGRESS")s&&s(50+Math.round(l.data.payload*.5));else if(l.data.type==="SUCCESS"){const z=new Blob([l.data.payload],{type:"application/pdf"});u({url:P(z),size:z.size,buffer:l.data.payload}),c.terminate()}else l.data.type==="ERROR"&&(N(new Error(l.data.payload)),c.terminate())},c.onerror=()=>{N(new Error("Worker failed to start or execution error.")),c.terminate()}}catch(c){N(new Error(`Failed to start worker: ${c.message}`))}})},G=async()=>{const t=n.filter(a=>!a.isLocked&&a.status==="pending");if(t.length===0)return;x(!0),v(0);const r=[],s=t.length===1;for(let a=0;a<t.length;a++){const o=t[a];d(i=>i.map(p=>p.id===o.id?{...p,status:"processing"}:p));try{const{url:i,size:p,buffer:D}=await q(o,h,s?v:void 0);if(r.push({name:o.file.name.replace(".pdf","-compressed.pdf"),buffer:D}),d(b=>b.map(u=>u.id===o.id?{...u,status:"completed",resultUrl:i,resultSize:p}:u)),V({name:o.file.name.replace(".pdf","-compressed.pdf"),tool:"Compress",size:p,resultUrl:i}),t.length===1){const b=await t[0].file.arrayBuffer();C({buffer:D,name:o.file.name.replace(".pdf","-compressed.pdf"),type:"application/pdf",originalBuffer:new Uint8Array(b)})}}catch{d(i=>i.map(p=>p.id===o.id?{...p,status:"error"}:p))}s||v(Math.round((a+1)/t.length*100))}if(r.length>1){const a=new I;r.forEach(i=>a.file(i.name,i.buffer));const o=await a.generateAsync({type:"blob"});P(o)}x(!1),F(!0)},J=async()=>{if(g&&n.length>1){const t=new I;for(const s of n)if(s.resultUrl){const a=await fetch(s.resultUrl);t.file(s.file.name.replace(".pdf","-compressed.pdf"),await a.arrayBuffer())}const r=await t.generateAsync({type:"blob"});await pe(new Uint8Array(await r.arrayBuffer()),"paperknife-compressed.zip","application/zip")}},W=()=>e.jsx("button",{onClick:G,disabled:k||n.filter(t=>!t.isLocked).length===0,className:"w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-lg shadow-rose-500/20 py-4 rounded-2xl text-sm md:p-6 md:rounded-3xl md:text-xl",children:k?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"animate-spin"})," ",f,"%"]}):e.jsxs(e.Fragment,{children:["Compress ",n.length>1?`${n.length} Files`:"PDF"," ",e.jsx(re,{size:18})]})});return e.jsxs(ue,{title:"Compress PDF",description:"Reduce file size while maintaining quality. Everything stays on your device.",actions:n.length>0&&!A&&e.jsx(W,{}),children:[e.jsx("input",{type:"file",multiple:!0,accept:".pdf",className:"hidden",ref:w,onChange:t=>t.target.files&&U(t.target.files)}),n.length===0?e.jsxs("div",{onClick:()=>w.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform shadow-inner",children:e.jsx($,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select PDFs"}),e.jsx("p",{className:"text-sm text-gray-400 font-medium",children:"Tap to start batch compression"})]}):A?e.jsxs("div",{className:"space-y-6 animate-in zoom-in duration-300",children:[g&&n.length>1&&e.jsxs("button",{onClick:J,className:"block w-full bg-zinc-900 dark:bg-white text-white dark:text-black p-10 rounded-[2.5rem] text-center shadow-2xl transition-all group active:scale-[0.98]",children:[e.jsx("div",{className:"w-16 h-16 bg-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform shadow-lg",children:e.jsx(te,{className:"text-white",size:32})}),e.jsx("h3",{className:"text-2xl font-black tracking-tight mb-1",children:Q?"Save ZIP Archive":"Download ZIP Archive"}),e.jsxs("p",{className:"text-xs font-bold opacity-60 uppercase tracking-widest",children:[n.length," Optimized PDFs"]})]}),g&&n.length===1&&e.jsxs("div",{className:"space-y-8",children:[y?.originalBuffer&&y?.buffer&&e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-[2.5rem] border border-gray-100 dark:border-white/5 shadow-sm",children:e.jsx(fe,{originalBuffer:y.originalBuffer,compressedBuffer:y.buffer})}),e.jsx(he,{message:`Reduced by ${((1-(n[0].resultSize||0)/n[0].file.size)*100).toFixed(0)}%`,downloadUrl:g,fileName:n[0].file.name.replace(".pdf","-compressed.pdf"),onStartOver:()=>{d([]),F(!1),j()}})]}),e.jsxs("button",{onClick:()=>{d([]),F(!1),j()},className:"w-full py-4 text-gray-400 hover:text-rose-500 font-black uppercase tracking-[0.3em] text-[10px] flex items-center justify-center gap-2",children:[e.jsx(se,{size:14})," Start New Session"]})]}):e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.map(t=>e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-4 rounded-[1.5rem] border border-gray-100 dark:border-white/5 flex items-center gap-4 relative group shadow-sm",children:[e.jsx("div",{className:"w-12 h-16 bg-gray-50 dark:bg-black rounded-lg overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800",children:t.thumbnail?e.jsx("img",{src:t.thumbnail,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Y,{className:"text-gray-300",size:16})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-black truncate dark:text-white",children:t.file.name}),t.isLocked?e.jsx("div",{className:"flex gap-1 mt-1",children:e.jsx("input",{type:"password",placeholder:"Locked...",className:"flex-1 bg-gray-50 dark:bg-black text-[10px] p-1.5 rounded-lg outline-none w-full border border-gray-100 dark:border-zinc-800 focus:border-rose-500",onKeyDown:r=>{r.key==="Enter"&&Z(t.id,r.currentTarget.value)}})}):e.jsxs("p",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-tighter",children:[(t.file.size/(1024*1024)).toFixed(2)," MB â€¢ ",t.pageCount," Pages"]})]}),e.jsx("button",{onClick:()=>d(r=>r.filter(s=>s.id!==t.id)),className:"p-2 text-gray-300 hover:text-rose-500 transition-colors",children:e.jsx(H,{size:16})})]},t.id)),e.jsxs("button",{onClick:()=>w.current?.click(),className:"border-2 border-dashed border-gray-100 dark:border-zinc-800 rounded-[1.5rem] p-4 text-gray-400 flex flex-col items-center justify-center gap-1 hover:border-rose-500 hover:text-rose-500 transition-all",children:[e.jsx(ee,{size:20}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Add More"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-[2rem] border border-gray-100 dark:border-white/5 shadow-sm",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-gray-400 mb-6 tracking-widest px-1",children:"Compression Strategy"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{id:"high",label:"Pro",desc:"Sharpest"},{id:"medium",label:"Balanced",desc:"Standard"},{id:"low",label:"Extreme",desc:"Smallest"}].map(t=>e.jsxs("button",{onClick:()=>E(t.id),className:`p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-1 ${h===t.id?"border-rose-500 bg-rose-50/50 dark:bg-rose-900/10":"border-gray-100 dark:border-white/5"}`,children:[e.jsx("span",{className:`font-black uppercase text-[10px] ${h===t.id?"text-rose-500":"text-gray-400"}`,children:t.label}),e.jsx("span",{className:"text-[8px] text-gray-400 font-bold uppercase",children:t.desc})]},t.id))}),e.jsxs("div",{className:"mt-6 p-6 bg-gray-50 dark:bg-black rounded-2xl border border-gray-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-rose-500/10 text-rose-500 flex items-center justify-center",children:e.jsx($,{size:16})}),e.jsx("h5",{className:"text-xs font-black uppercase tracking-widest dark:text-white",children:"Strategy Details"})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-zinc-400 leading-relaxed",children:[h==="high"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Pro Mode:"})," Retains maximum text clarity and image resolution (1.0x scale). Best for official documents, portfolios, and high-fidelity reports. Expected reduction: ",e.jsx("span",{className:"text-rose-500 font-bold",children:"10-30%"}),"."]}),h==="medium"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Balanced:"})," Downsamples images to 150DPI (1.5x scale) with optimized JPEG compression. The perfect middle ground for everyday sharing and email attachments. Expected reduction: ",e.jsx("span",{className:"text-rose-500 font-bold",children:"40-60%"}),"."]}),h==="low"&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Extreme:"})," Aggressive downsampling (2.0x scale) and high compression. Ideal for quick mobile viewing or meeting strict 2MB upload limits. Expected reduction: ",e.jsx("span",{className:"text-rose-500 font-bold",children:"70-90%"}),"."]})]})]}),k&&e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsx("div",{className:"w-full bg-gray-100 dark:bg-zinc-800 h-2 rounded-full overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-rose-500 h-full transition-all",style:{width:`${f}%`}})}),e.jsx("p",{className:"text-[10px] text-center font-black uppercase text-gray-400 tracking-widest animate-pulse",children:"Rasterizing Document..."})]})]})]}),e.jsx(ce,{})]})}export{Se as default};

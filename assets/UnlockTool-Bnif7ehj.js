import{C as N,j as e,a as P}from"./index-DKV7Eaui.js";import{r as o,n as F,l as L,$ as U,X as C,Y as S,E as z}from"./vendor-ui-BR-XW_se.js";import{P as D}from"./pdf-lib-core-B0uti0Qf.js";import{N as B,P as E,g as R,u as $}from"./NativeToolLayout-Dq_G7LhW.js";import{u as T}from"./useObjectURL-CnrGu85N.js";import{S as A}from"./SuccessState-DM_Hem-J.js";import"./pdfjs-viewer-BENO9Ct1.js";function H(){const i=o.useRef(null),{objectUrl:l,createUrl:h,clearUrls:d}=T(),[s,u]=o.useState(null),[x,p]=o.useState(!1),[t,n]=o.useState(""),[c,m]=o.useState("paperknife-unlocked"),b=N.isNativePlatform(),k=async r=>{if(r.type!=="application/pdf")return;const a=await R(r);u({file:r,thumbnail:a.thumbnail,pageCount:a.pageCount,isLocked:a.isLocked}),m(`${r.name.replace(".pdf","")}-unlocked`),d(),n("")},j=r=>{r.target.files?.[0]&&k(r.target.files[0])},y=async()=>{if(!(!s||s.isLocked&&!t)){p(!0),await new Promise(r=>setTimeout(r,100));try{if(!(await $(s.file,t)).success)throw new Error("Incorrect password.");const a=await s.file.arrayBuffer(),w=await(await D.load(a,{password:t||void 0,ignoreEncryption:!0})).save(),g=new Blob([w],{type:"application/pdf"}),v=h(g);P({name:`${c||"unlocked"}.pdf`,tool:"Unlock",size:g.size,resultUrl:v})}catch(r){z.error(r.message||"Error.")}finally{p(!1)}}},f=()=>e.jsx("button",{onClick:y,disabled:x||s?.isLocked&&!t,className:`w-full bg-rose-500 hover:bg-rose-600 text-white font-black uppercase tracking-widest transition-all active:scale-95 disabled:opacity-50 flex items-center justify-center gap-3 shadow-xl shadow-rose-500/20 ${b?"py-4 rounded-2xl text-sm":"p-6 rounded-3xl text-xl"}`,children:x?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"animate-spin"})," Working..."]}):e.jsxs(e.Fragment,{children:["Unlock PDF ",e.jsx(S,{size:18})]})});return e.jsxs(B,{title:"Unlock PDF",description:"Remove passwords and restrictions permanently. Processed locally.",actions:s&&!l&&e.jsx(f,{}),children:[e.jsx("input",{type:"file",accept:".pdf",className:"hidden",ref:i,onChange:j}),s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-zinc-900 p-6 rounded-3xl border border-gray-100 dark:border-white/5 flex items-center gap-6",children:[e.jsx("div",{className:"w-16 h-20 bg-gray-50 dark:bg-black rounded-xl overflow-hidden shrink-0 border border-gray-100 dark:border-zinc-800 flex items-center justify-center text-rose-500",children:s.thumbnail?e.jsx("img",{src:s.thumbnail,className:"w-full h-full object-cover"}):e.jsx(L,{size:20})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate dark:text-white",children:s.file.name}),e.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-black",children:s.isLocked?"Locked":"Unlocked"})]}),e.jsx("button",{onClick:()=>u(null),className:"p-2 text-gray-400 hover:text-rose-500 transition-colors",children:e.jsx(U,{size:20})})]}),e.jsx("div",{className:"bg-white dark:bg-zinc-900 p-8 rounded-3xl border border-gray-100 dark:border-white/5 space-y-6",children:l?e.jsx(A,{message:"Unlocked Successfully",downloadUrl:l,fileName:`${c||"unlocked"}.pdf`,onStartOver:()=>{d(),n("")}}):e.jsxs("div",{className:"space-y-6",children:[s.isLocked?e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Password"}),e.jsx("input",{type:"password",value:t,onChange:r=>n(r.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm text-center",placeholder:"••••••••",autoFocus:!0})]}):e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/10 rounded-xl border border-green-100 dark:border-green-900/20 text-center",children:e.jsx("p",{className:"text-green-600 dark:text-green-400 font-bold text-xs",children:"File is already unlocked!"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black uppercase text-gray-400 mb-2",children:"Filename"}),e.jsx("input",{type:"text",value:c,onChange:r=>m(r.target.value),className:"w-full bg-gray-50 dark:bg-black rounded-xl px-4 py-3 border border-transparent focus:border-rose-500 outline-none font-bold text-sm"})]}),!b&&e.jsx(f,{})]})})]}):e.jsxs("div",{onClick:()=>i.current?.click(),className:"border-4 border-dashed border-gray-100 dark:border-zinc-900 rounded-[2.5rem] p-12 text-center hover:bg-rose-50 dark:hover:bg-rose-900/10 transition-all cursor-pointer group",children:[e.jsx("div",{className:"w-20 h-20 bg-rose-50 dark:bg-rose-900/20 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform",children:e.jsx(F,{size:32})}),e.jsx("h3",{className:"text-xl font-bold dark:text-white mb-2",children:"Select Locked PDF"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Tap to browse files"})]}),e.jsx(E,{})]})}export{H as default};
